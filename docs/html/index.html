
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>pyCRP: python Continuous Readout Processing documentation &#8212; pyCRP 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">pyCRP 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyCRP: python Continuous Readout Processing documentation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="pycrp-python-continuous-readout-processing-documentation">
<h1>pyCRP: python Continuous Readout Processing documentation<a class="headerlink" href="#pycrp-python-continuous-readout-processing-documentation" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p><strong>1. Introduction</strong></p>
<p>This package provides triggering and optimum-filter reconstruction on continuous data stream with an easily manageable configuration interface. The current implemented IO functions support data from SuperCDMS-MIDAS, SuperCDMS-Animal and. User can also use a customized IO function for their particular data format.</p>
<p>The triggering process is demonstrated in the following figure: an optional filter (optimal filter, Gaussian filter, or other customized kernels that are not shown) is applied to the raw trace to reduce the noise; a threshold trigger is performed on the filtered trace and trigger points are shown in dots. Around each trigger points, a piece of trace is selected for further reconstruction and calculation of reduced quantities (RQs).</p>
<p>This rather simple process can get cumbersum when the sturcture of data is complicated. For example, when there are multiple channels with different setup and requires different filtering/trigger threshold, etc. Or when there are hundreds of files to process, a way to run multiple jobs in parallel is helpful. These are taken care of by this package:</p>
<p>A configuration file that can be generated by a Graphic User Interface (GUI) give you easy access and reproducibility of tens of parameters
It also supports batch processing for LSF batch system (slurm job submission is to be implemented).</p>
<p><strong>2. Installation</strong></p>
<p><em>2.1. Dependencies</em></p>
<ol class="upperalpha">
<li><p>If you have access to cdms software release via cvmfs, setup the environment with</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/cvmfs/cdms.opensciencegrid.org/setup_cdms.sh</span> <span class="pre">V04-03</span></code></p>
</div></blockquote>
</li>
</ol>
<p>If there are still some packages missing, they usually can be installed with the command <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">PACKAGE_NAME</span> <span class="pre">--user</span></code></p>
<ol class="upperalpha simple" start="2">
<li><p>If you are on a local computer, conda can be used to install dependencies</p></li>
</ol>
<p>In the parent directory of pycrp, a new environment <code class="docutils literal notranslate"><span class="pre">pycrp_env</span></code> with dependencies can be created:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">--prefix</span> <span class="pre">./pycrp_env</span> <span class="pre">--file</span> <span class="pre">pyCRP/environment.yml</span></code>
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">./pycrp_env</span></code></p>
</div></blockquote>
<p>This will not install <cite>pyROOT</cite> and SuperCDMS <cite>pyRawIO</cite>. pyCRP can work without pyROOT and pyRawIO.  <cite>pyROOT</cite> is only used in the likelihood fit in pyCRP. <cite>pyRawIO</cite> provide interface for SuperCMDS MIDAS data. It may be challenging to install SuperCDMS <cite>pyRawIO</cite>, as it requires <cite>boost-python</cite>,`pyROOT`, SuperCDMS <cite>BatCommon</cite> and <cite>IOLibrary</cite>. An alternate is the python interface provided by <a class="reference external" href="https://midas.triumf.ca/MidasWiki/index.php/Python">MIDAS</a>. To install this midas python interface, download code from <a class="reference external" href="https://bitbucket.org/tmidas/midas/src/develop/python/">Bitbucket</a>, and do</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">midas/python</span> <span class="pre">--user</span></code></p>
</div></blockquote>
<ol class="upperalpha" start="3">
<li><p>If you are using Narvel, use the singularity image instead.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">sigularity</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">exec</span> <span class="pre">-B</span> <span class="pre">&quot;/project/def-zqhong/&quot;</span> <span class="pre">/project/def-zqhong/RicochetSoftware/singularity/RicochetSoft-v1.4/ricochetsoft.sif</span> <span class="pre">run_processing</span> <span class="pre">--series</span> <span class="pre">&quot;SERIES_NUMBER&quot;</span> <span class="pre">--config</span> <span class="pre">&quot;CONFIG_FILE&quot;</span> <span class="pre">(--overwrite)</span> <span class="pre">(--overwrite_psd)</span></code></p>
</div></blockquote>
</li>
</ol>
<p>To rebuild the sigularity image, find the recipe file and do:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">build</span> <span class="pre">--remote</span> <span class="pre">/project/def-zqhong/RicochetSoftware/singularity/RicochetSoft-v1.4/ricochetsoft.sif</span> <span class="pre">./ricochetsoft.recipe</span></code></p>
</div></blockquote>
<p>Need to <a class="reference external" href="https://cloud.sylabs.io/tokens">re-create token</a> every month, To reset token:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">remote</span> <span class="pre">login</span></code></p>
</div></blockquote>
<p><em>2.2 Installing with pip</em></p>
<p>We highly recommed using <cite>pip</cite> and/or <cite>virtualenv</cite> to manage your python packages, but you can also just edit your paths if desired.</p>
<p>Download pycrp repository,</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;gitlab.com:supercdms/Analysis/pyCRP.git</span></code></p>
</div></blockquote>
<p>Inside the pyCRP directory <strong>where you can see setup.py</strong>,</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span> <span class="pre">--user</span> <span class="pre">--no-use-pep517</span></code></p>
</div></blockquote>
<p><cite>-e</cite> option installs pycrp with edit mode, <cite>–user</cite> option will let you install into your user directory if you don’t have admin permissions, <cite>–no-use-pep517</cite> needed because pep517 does not support -e or –user</p>
<p>Or you can directly install by running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">.</span></code> if you have admin permission</p>
<p><strong>3. Working with git</strong></p>
<p>To clone this repository first you need to set up a GitLab account with a two-factor authentication and request an access to the SuperCDMS group, as described here: <a class="reference external" href="https://confluence.slac.stanford.edu/display/CDMS/Getting+Started+with+Git">confluence</a></p>
<p>Cloning:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;gitlab.com:supercdms/Analysis/pyCRP.git</span></code></p>
</div></blockquote>
<p>Alternative repo if you can access bitbucket:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;bitbucket.org:phys-ricochet/pycrp.git</span></code></p>
</div></blockquote>
<p>If you wish to commit to the repo, please switch to the develop branch:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">pyCRP</span></code>
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">develop</span> <span class="pre">origin/develop</span></code></p>
</div></blockquote>
<p>If you are developing a new feature, create your own branch and merge it to develop when you are done. Do not commit directly to the master branch!</p>
<ol class="arabic simple">
<li><p>Create a new branch <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">branch</span> <span class="pre">your_branch</span></code>. Or if you have one already, switch to it, and merge the develop into it: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">your_branch</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span> <span class="pre">develop</span></code></p></li>
<li><p>Develope features, commit as usual <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">'Commit</span> <span class="pre">message:</span> <span class="pre">describe</span> <span class="pre">your</span> <span class="pre">changes</span> <span class="pre">here'</span></code></p></li>
<li><p>To push your commits to gitlab, do <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">-u</span> <span class="pre">origin</span> <span class="pre">your_branch</span></code></p></li>
<li><p>When you wish to merge your code to the common branch (develop), do <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">develop</span></code>, <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">merge</span> <span class="pre">your_branch</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">--all</span> <span class="pre">origin</span></code></p></li>
</ol>
<p><strong>4. Example notebooks for beginners</strong></p>
<p><a class="reference external" href="https://gitlab.com/supercdms/Analysis/pyCRP/-/blob/master/pycrp/notebook_examples/OF_demonstration.ipynb">Optimal Filter</a> or <a class="reference external" href="https://bitbucket.org/phys-ricochet/pycrp/src/master/pycrp/notebook_examples/OF_demonstration.ipynb">bitbucket link</a></p>
<p><a class="reference external" href="https://gitlab.com/supercdms/Analysis/pyCRP/-/blob/master/pycrp/notebook_examples/pyCRP_Example.ipynb">pyCRP example</a> or <a class="reference external" href="https://bitbucket.org/phys-ricochet/pycrp/src/master/pycrp/notebook_examples/pyCRP_Example.ipynb">bitbucket link</a></p>
<p>You can download them and run with jupyter notebook. The Optimal filter aims to give you a rough idea on how optimal filter works, while the pyCRP tells you how to make a config file and do analysis with pyCRP.</p>
<p>It’s always a good idea to test with the <em>processing debug</em> notebook. You can find it under <code class="docutils literal notranslate"><span class="pre">pycrp/processing</span></code> directory</p>
</section>
<section id="frequently-encountered-errors">
<h2>Frequently Encountered Errors<a class="headerlink" href="#frequently-encountered-errors" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>local variable ‘traces’ referenced before assignment</p></li>
</ul>
<p>While running run_processing.py, you get the error:</p>
<p>local variable ‘traces’ referenced before assignment</p>
<p>this means the series you told it to process is empty; it does not actually have any data in it.</p>
<p>This could be because it does not exist. Check:</p>
<p>Did you spell the series name correctly?</p>
<p>Did you give it the right data directory?</p>
<ul class="simple">
<li><p>_optimum_filter.py: np.dot(Tf.Conjugate/J,Tf) incompatible shapes</p></li>
</ul>
<p>While make RQs, you encounter an “incompatible shapes” error in this line of _optimum_filter.py:
np.dot(Tf.Conjugate/J,Tf)</p>
<p>The error likely isn’t in regards to the np.dot, but rather in regards to Tf.Conjugate/J.</p>
<p>J has length equal to TRACE_LENGTH in your config.</p>
<p>Meanwhile Tf is your template, it has length depending on what you had set your template as.</p>
<p>These two lengths have to be equal for division to make sense.</p>
<p>If you are using the “default” template option in your config, verify that that has the same length as your TRACE_LENGTH</p>
<p>Alternatively just use an “analytic:20e-6,80e-6” template for Animal data.</p>
<ul class="simple">
<li><p>“PSD autocut acceptance is always 0!” error</p></li>
</ul>
<p>While calculating PSDs, you recieve the massage “Autocuts are too harsh, rerunning random triggering” for a few times,
then encounter a “PSD autocut acceptance is always 0!” error :</p>
<p>“Autocut” function decided there are pulses in most(&gt;99%) of the traces selected, and rejected all of them.</p>
<p>You can include more traces before autocut: increase config.PSD_MAX_TRACES and config.PSD_FILES
Or use a shorter trace length.</p>
<p>If you want to include the pulses in your PSDs (<em>usually you don’t</em>), Set traces_cut=traces to skip the auto cut.</p>
</section>
</section>
<section id="scripts">
<h1>Scripts<a class="headerlink" href="#scripts" title="Permalink to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="fitting-tools">
<h2>Fitting tools<a class="headerlink" href="#fitting-tools" title="Permalink to this heading">¶</a></h2>
<p>One useful function in this script is the <code class="docutils literal notranslate"><span class="pre">pycrp.Fit.fitGaus_from_hist</span></code>, it fits a gaussian from histgram. Use this function if you need to fit from a histgram of some OFs. It assumes Poissonian error for each of the bin but we approximate the error as Gaussian so we still use the least squares method for fitting.</p>
<p>Fitb uses the lmfit (Non-Linear Least-Squares Minimization and Curve-Fitting for Python) package for curve fitting for different distributions.</p>
<span class="target" id="module-pycrp._fit"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._fit.Fit">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._fit.</span></span><span class="sig-name descname"><span class="pre">Fit</span></span><a class="headerlink" href="#pycrp._fit.Fit" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py class">
<dt class="sig sig-object py" id="pycrp._fit.Fit.Chi2Mod1">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Chi2Mod1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">e</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.Chi2Mod1" title="Permalink to this definition">¶</a></dt>
<dd><p>Modified chi2, when the model also have uncertainty</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pycrp._fit.Fit.GenericChi2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">GenericChi2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">e</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.GenericChi2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._fit.Fit.fitGaus_from_hist">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitGaus_from_hist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ibins</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitrange</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poissonerror</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interp_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sidebands</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.fitGaus_from_hist" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the histogram with Gaussian function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n</strong> (<em>array-like</em>) – Y axis of the hist</p></li>
<li><p><strong>ibins</strong> (<em>array-like</em>) – X axis of the hist</p></li>
<li><p><strong>fitrange</strong> (<em>int list</em>) – List with two elements: start and end index of fit.</p></li>
<li><p><strong>poissonerror</strong> (<em>boolean</em>) – Y error follows the poisson or not. Set y error to 1 if False</p></li>
<li><p><strong>interp_points</strong> (<em>int</em>) – Number of interpolation points between maximum and minimum x</p></li>
<li><p><strong>p0</strong> (<em>array</em><em>, </em><em>optional</em>) – Initial guess for the parameters</p></li>
<li><p><strong>make_plot</strong> (<em>boolean</em>) – Make plot if True</p></li>
<li><p><strong>sidebands</strong> (<em>boolean</em>) – Must be True now. The function is not defined for False</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>popt</strong> (<em>array</em>) – Optimal values for the parameters so that the sum of the squared residuals of f(xdata, <a href="#id2"><span class="problematic" id="id3">*</span></a>popt) - ydata is minimized.</p></li>
<li><p><strong>pcov</strong> (<em>2-D array</em>) – The estimated covariance of popt. The diagonals provide the variance of the parameter estimate. To compute one standard deviation errors on the parameters use perr = np.sqrt(np.diag(pcov)).</p></li>
<li><p><strong>plot_x</strong> (<em>array</em>) – x axis of fitting</p></li>
<li><p><strong>plot_y</strong> (<em>array</em>) – y axis of fitting</p></li>
<li><p><strong>bincenters</strong> (<em>float</em>) – center of the bins which is the pfeak energy</p></li>
<li><p><strong>n</strong> (<em>array-like</em>) – Unprocessed y axis of the hist, same as the input array</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._fit.Fit.fitb">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ydata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_range=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">functions=(&lt;function</span> <span class="pre">Utils.Gauss&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_format=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name='Fit'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method='leastsq'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_values=((0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds=(((0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1000000.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">(-1000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1000000.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">(0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1000000.0))</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_constant=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.fitb" title="Permalink to this definition">¶</a></dt>
<dd><p>Least-square fit using lmfit
<a class="reference external" href="https://lmfit.github.io/lmfit-py/fitting.html#lmfit.minimizer.MinimizerResult">https://lmfit.github.io/lmfit-py/fitting.html#lmfit.minimizer.MinimizerResult</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xdata</strong> (<em>1-d array</em><em> or </em><em>list</em>) – input data array to fit</p></li>
<li><p><strong>ydata</strong> (<em>1-d array</em><em> or </em><em>list</em>) – input data array to fit</p></li>
<li><p><strong>fit_range</strong> (<em>tuple</em>) – data range for the fit (x_lower, x_upper)</p></li>
<li><p><strong>functions</strong> (<em>tuple of python functions</em>) – Examples:
Utils.Gauss, Utils.Uniform, Utils.Poly, Utils.Exp</p></li>
<li><p><strong>sigma</strong> (<em>None</em><em>, </em><em>boolean</em><em>, </em><em>ndarray</em>) – Uncertainy on each point.
None (default): use equal weight to each bin
Ture: Poisson error sqrt(n)
ndarray: user-defined error</p></li>
<li><p><strong>return_format</strong> (<em>int</em>) – format of return value
0 (default):x, y, param_values, param_errors
1: full fit result</p></li>
<li><p><strong>name</strong> (<em>None</em><em>, </em><em>str</em>) – Name of fit function</p></li>
<li><p><strong>initial_values</strong> (<em>tuple of tuples of floats</em>) – inital values of parameters
Example:
functions=(Utils.Gauss, Utils.Exp, Utils.Poly), initial_values=((A,mean, sigma), (exp_A, exp_k), (p0, p1, p2, …))</p></li>
<li><p><strong>bounds</strong> (<em>tuple of tuples of tuples of floats</em>) – min and max allowed parameter values
Example:
functions=(Utils.Gauss, Utils.Exp, Utils.Poly), bounds=(((min_a, max_a),(min_mean, max_mean),(min_sig,max_sig)), ((min_a, max_a),(min_k, max_k),))</p></li>
<li><p><strong>set_constant</strong> (<em>tuple of tuples of bools</em><em>   or   </em><em>None</em>) – whether to fix a certain parameter at a constant value.
If equals to None, then none of the parameters is fixed
Example:
functions=(Utils.Gauss, Utils.Exp), set_constant=((fix_A,fix_mean, fix_sigma), (fix_A, fix_k))</p></li>
<li><p><strong>verbose</strong> (<em>int</em>) – <dl class="simple">
<dt>verbosity level (might not work. It’s tricky)</dt><dd><p>0 - print fit results (default)
1 - print fit results and correlation
2 - print info (fit function,parameters settings)</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>If return_format==0</em></p></li>
<li><p><em>x, y, param_values, param_errors</em></p></li>
<li><p><strong>x</strong> (<em>array</em>) – bin centers</p></li>
<li><p><strong>y</strong> (<em>array</em>) – fit function values</p></li>
<li><p><strong>param_values</strong> (<em>tuple of tuples</em>) – values of fitted parameters. Has the same shape as ‘initial_values’ arg</p></li>
<li><p><strong>param_errors</strong> (<em>tuple of tuples</em>) – errors of fitted parameters. Has the same shape as ‘initial_values’ arg</p></li>
<li><p><em>If return_format==1</em></p></li>
<li><p><em>retult,func, param_values, param_errors</em></p></li>
<li><p><strong>result</strong> (<em>minimizer result object</em>) – <a class="reference external" href="https://lmfit.github.io/lmfit-py/fitting.html#lmfit.minimizer.MinimizerResult">https://lmfit.github.io/lmfit-py/fitting.html#lmfit.minimizer.MinimizerResult</a></p></li>
<li><p><strong>func</strong> (<em>fit function</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._fit.Fit.fitb_hist">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitb_hist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_range=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">functions=(&lt;function</span> <span class="pre">Utils.Gauss&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_format=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name='Fit'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_values=((0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds=(((0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1000000.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">(-1000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1000000.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">(0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">1000000.0))</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_constant=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.fitb_hist" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper of Fit.histb() to accept the binning data directly from a numpy.histogram
See fitb for details</p>
<dl class="simple">
<dt>h: tuple</dt><dd><p>h = (n,ibins) and is the return of np.histogram</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._fit.Fit.getParams">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getParams</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">result</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.getParams" title="Permalink to this definition">¶</a></dt>
<dd><p>extract the fit values and errors from fit result</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._fit.Fit.getPrintable">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getPrintable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">result</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.getPrintable" title="Permalink to this definition">¶</a></dt>
<dd><p>Organize the fit result into printable format
Inputs
——-
result: lmfit model.result object</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>fit_result_print</strong> (<em>str</em>) – A string formated with parameter name, value and uncertainty</p></li>
<li><p><em>Example of printing this to a plot</em></p></li>
<li><p><strong>plt.text(1.05,1,fit_result_print,transform=gca().transAxes,fontdict={‘family’</strong> (<em>‘monospace’})</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._fit.Fit.plotFunctions">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">plotFunctions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">xdata,</span> <span class="pre">functions=(&lt;function</span> <span class="pre">Utils.Gauss&gt;,),</span> <span class="pre">initial_values=[(0.0,</span> <span class="pre">1.0,</span> <span class="pre">1.0)],</span> <span class="pre">n=500,</span> <span class="pre">color='r',</span> <span class="pre">linestyle='--',</span> <span class="pre">linewidth=1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._fit.Fit.plotFunctions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="io">
<h2>IO<a class="headerlink" href="#io" title="Permalink to this heading">¶</a></h2>
<p>Loading data</p>
<p>If you want to add new datatype to pyCRP, make a io_{datatype}.py file and add {datatype} to the following list in _io.py:</p>
<p>Find <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">data_type</span> <span class="pre">in</span> <span class="pre">[&quot;NEXUS&quot;,</span> <span class="pre">&quot;Animal&quot;,</span> <span class="pre">&quot;UMass&quot;,</span> <span class="pre">&quot;MIT&quot;,</span> <span class="pre">&quot;Argonne&quot;]:</span></code></p>
<p>and change it to``if data_type in [“NEXUS”, “Animal”, “UMass”, “MIT”, “Argonne”, “{datatype}”]:``</p>
<p>See io_template for how to add a new io type</p>
<span class="target" id="module-pycrp._io"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._io.IO">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._io.</span></span><span class="sig-name descname"><span class="pre">IO</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename_pattern</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Series</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NEXUS'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">USER_IO_FILENAME</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keylist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_loop_single_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO" title="Permalink to this definition">¶</a></dt>
<dd><p>Class for loading data.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._io.IO.filename_pattern">
<span class="sig-name descname"><span class="pre">filename_pattern</span></span><a class="headerlink" href="#pycrp._io.IO.filename_pattern" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Can be either</dt><dd><ul class="simple">
<li><p>full filename</p></li>
<li><p>series number, need to specify data_dir and data_type</p></li>
<li><p>a string with wildcard</p></li>
<li><p>a string with f-string format and with wildcard with “series” as a variable, and provide a list of series <cite>Series</cite>
Note that it should be given as a normal string, without the initial f’’. for example, “/{series}/{series}_F*.mid.gz”</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._io.IO.Series">
<span class="sig-name descname"><span class="pre">Series</span></span><a class="headerlink" href="#pycrp._io.IO.Series" title="Permalink to this definition">¶</a></dt>
<dd><p>Used when filename_pattern is f-string like</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of series string</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._io.IO.N_files">
<span class="sig-name descname"><span class="pre">N_files</span></span><a class="headerlink" href="#pycrp._io.IO.N_files" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li><p>None: return all filenames of this series</p></li>
<li><p>int N: return N filenames starting from the first one</p></li>
<li><p>tuple (N1,N2): return the N1^th to N2^th filenames</p></li>
<li><p>list: return the filenames following the indices in the list</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>None, int, tuple or list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._io.IO.data_type">
<span class="sig-name descname"><span class="pre">data_type</span></span><a class="headerlink" href="#pycrp._io.IO.data_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Choose one from (“NEXUS”,”Animal”, “UMass”, “MIT”, “Argonne”,”RQ”)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._io.IO.keylist">
<span class="sig-name descname"><span class="pre">keylist</span></span><a class="headerlink" href="#pycrp._io.IO.keylist" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify which keys to read. If none, will read all keys</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>None, list of str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._io.IO.data_loop_single_file">
<span class="sig-name descname"><span class="pre">data_loop_single_file</span></span><a class="headerlink" href="#pycrp._io.IO.data_loop_single_file" title="Permalink to this definition">¶</a></dt>
<dd><p>False (default): load one file each time
True: load one trace inside the file each time</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO._load">
<span class="sig-name descname"><span class="pre">_load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keylist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO._load" title="Permalink to this definition">¶</a></dt>
<dd><p>file IO to load a single file or a chunk if data_loop_single_file is true</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO.get_ifile">
<span class="sig-name descname"><span class="pre">get_ifile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO.get_ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>Return file index that <strong>was</strong> loaded
Note, get_ifile will be different from io_file.ifile by 1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO.get_itrace">
<span class="sig-name descname"><span class="pre">get_itrace</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO.get_itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return file index that <strong>was</strong> loaded
Note, get_itrace will be different from io_file.itrace by 1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Read one file if data_loop_single_file is false</p>
<p>Read one chunk of data if data_loop_single_file is true</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO.load_all">
<span class="sig-name descname"><span class="pre">load_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO.load_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Read all files together</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO.n_chunks">
<span class="sig-name descname"><span class="pre">n_chunks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO.n_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return estimated number of chunks, estimated with io_file
If io_file is not present, return -1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._io.IO.reset_counters">
<span class="sig-name descname"><span class="pre">reset_counters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.IO.reset_counters" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset file index and trace index counters</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pycrp._io.use_local_midas">
<span class="sig-prename descclassname"><span class="pre">pycrp._io.</span></span><span class="sig-name descname"><span class="pre">use_local_midas</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._io.use_local_midas" title="Permalink to this definition">¶</a></dt>
<dd><p>Try to import local midas library for local non-supercdms kernel</p>
</dd></dl>

</section>
<section id="trigger">
<h2>Trigger<a class="headerlink" href="#trigger" title="Permalink to this heading">¶</a></h2>
<p>To process a continous stream of data, you will first need to trigger at the pulses.</p>
<p>There are four types of trigger algorithm in pyCRP: random, reshape, threshold, and shaping.</p>
<p><strong>1. Random trigger</strong></p>
<p>The random trigger works by randomly picking trigger points in the raw trace.</p>
<p>Suppose you have a raw trace of 100k samples, and you want the event trace length to be 8192 (4096 pretrigger and 4096 posttrigger). If the random trigger rate is 5, then the random trigger will randomly pick 5 numbers between 4096 to 100k-4096 as the trigger point. You may choose if you don’t want any overlap between traces. In this example, if you want no overlap, the minimum distance between any two random triggers will be 8192.</p>
<p><strong>2. Reshape</strong></p>
<p>You rarely need this. Suppose you have a raw trace of 100k samples, and you want the event trace length to be 8192 (4096 pretrigger and 4096 posttrigger), then starting from 4096, it will trigger every 8192 samples until there are not enough samples after the trigger point.</p>
<p><strong>3. Threshold trigger</strong></p>
<p>Trigger when the signal exceeds a given value.</p>
<p>Tips: If you want to trigger on the failing edge of the signal, you can flip the raw trace by setting the gain of that channel to -1 in the config file. Then the failing edge becomes the raising edge!</p>
<p><strong>4. Threshold trigger with shaping</strong></p>
<p>This is the trigger we usually use for pulse triggering.</p>
<p>Shaping is also a threshold trigger, but some filter will be applied on the raw traces before triggering to reject noise.</p>
<p>The most common filter we use is the Gaussian filter with given order(usually 1 which means derivative), sigma, truncation(in unit of sigma). For details about Gaussian filter see <a class="reference external" href="https://www.cs.cornell.edu/courses/cs6670/2011sp/lectures/lec02_filter.pdf">slide 40 of this presentation</a> or just Google “gaussian derivative filter”.</p>
<span class="target" id="module-pycrp._trigger"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._trigger.</span></span><span class="sig-name descname"><span class="pre">Trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">io_user</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ADC2uA</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">625000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trig_pileup_window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">250</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_holdoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_LED_dummy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LED_frequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">real_trace_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">156250</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>dict</em>) – The output of uio.load(). Raw data loaded by io</p></li>
<li><p><strong>channel_config</strong> (<em>dict</em>) – A dictionary with channel configuration.</p></li>
<li><p><strong>transform</strong> (<em>None</em>) – Not used for now</p></li>
<li><p><strong>io_user</strong> (<em>uio.io_file</em>) – The io file to read metadata</p></li>
<li><p><strong>ADC2uA</strong> (<em>float</em>) – ADC to uA convert factor. Use config.ADC2uA if needed.</p></li>
<li><p><strong>pre_trig/post_trig</strong> (<em>int</em>) – pre/post trigger trace length. Use config.pre_trig/post_trig if needed.</p></li>
<li><p><strong>trig_pileup_window</strong> (<em>int</em>) – A window for trig_pileups</p></li>
<li><p><strong>trigger_holdoff</strong> (<em>float</em>) – Time. Reject trigger within trigger_holdoff time. Set to -1 to disable</p></li>
<li><p><strong>verbose</strong> (<em>boolean</em>) – Print trigger configuration if True</p></li>
<li><p><strong>make_LED_dummy</strong> (<em>booloan</em>) – If True, do interplate LED triggers base on the threshold trigger information. This function is designed for NEXUS HVeV Run 4, where the trigger for calibration data is not provided. If you want to use this feature, there are more docs in config_template.</p></li>
<li><p><strong>LED_frequency</strong> (<em>float</em>) – The frequency of the calibration source</p></li>
<li><p><strong>real_trace_length</strong> (<em>float</em>) – The <em>accurate</em> trace length of one DAQ trace</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._filter_data">
<span class="sig-name descname"><span class="pre">_filter_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trigger_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._filter_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter the data base on the filter channel selected by _make_filter_kernels</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._make_filter_kernels">
<span class="sig-name descname"><span class="pre">_make_filter_kernels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">templates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PSDs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_dummy_template</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._make_filter_kernels" title="Permalink to this definition">¶</a></dt>
<dd><p>Choose which filter kernel to use</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._make_kernel_OF">
<span class="sig-name descname"><span class="pre">_make_kernel_OF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._make_kernel_OF" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply OF to an array</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._make_kernel_dummypulse">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_make_kernel_dummypulse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">AC_coulpled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">625000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._make_kernel_dummypulse" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a analytical pulse template</p>
<p>pre_trig, post_trig: int
Bins (<em>not time</em>) before/after trigger.</p>
<p>tau1,tau2: float
Rise time/ Fall time (<em>not bins</em>)</p>
<p>AC_coulpled: boolean
Set mean to 0 if True</p>
<p>Fs: float
Frequency. Use config.Fs if needed</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._make_kernel_gauss">
<span class="sig-name descname"><span class="pre">_make_kernel_gauss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gaus_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gaus_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gaus_truncate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._make_kernel_gauss" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a guassian filter to an array</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._make_kernel_savgol">
<span class="sig-name descname"><span class="pre">_make_kernel_savgol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">window_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._make_kernel_savgol" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a Savitzky-Golay filter to an array</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._preprocess_data">
<span class="sig-name descname"><span class="pre">_preprocess_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._preprocess_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._run_random_trigger">
<span class="sig-name descname"><span class="pre">_run_random_trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_random_per_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reshaping_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._run_random_trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper function of self.random_trigger()</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._set_rawdata">
<span class="sig-name descname"><span class="pre">_set_rawdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">625000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._set_rawdata" title="Permalink to this definition">¶</a></dt>
<dd><p>Copying raw data and add channels based on channel_config. Example:
channel_config={</p>
<blockquote>
<div><dl class="simple">
<dt>“NFF_out”:{                                   # 1. Same as raw data, renamed to NFF_out.</dt><dd><p>“sub_channels”:[“1-PBS”],},</p>
</dd>
<dt>“NFF_total”:{                                 # 2. Adding two channels from raw data</dt><dd><p>“sub_channels”:[“1-PAS”,”1-PBS”],          # – weights and names of raw data channels
“istrigger_channel”:True,                 # – trigger on this channel
“trigger_type”:”Shaping”,                 # – trigger type, one of “Reshape”,”Random”,”Threshold”,”Shaping”
“trigger_kernel”:”Gauss”                  # – trigger kernel
“trigger_threshold”:”6sigma”              # – trigger threshold and other options
},</p>
</dd>
<dt>“Random”:{                                    # 3. Example of Random trigger</dt><dd><p>“istrigger_channel”:True,                 # – trigger on this channel
“trigger_type”:”Random”,                  # – trigger type
“trigger_random_rate”:2},                 # – RANDOM TRIGGER RATE: 2 per trace
}</p>
</dd>
</dl>
</div></blockquote>
<p>Trigger related parameters:
0) Just reshaping:</p>
<blockquote>
<div><p>“trigger_type”:            “Reshape”,     # – trigger type: “Reshape”,”Random”,”Threshold”,”Shaping”</p>
</div></blockquote>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Random trigger</dt><dd><p>“trigger_type”:            “Random”,      # – trigger type: “Reshape”,”Random”,”Threshold”,”Shaping”
“trigger_random_rate”:     2,             # – RANDOM TRIGGER RATE: 2 per trace</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Threshold trigger</dt><dd><p>“trigger_type”:            “Threshold”,   # – trigger type: “Reshape”,”Random”,”Threshold”,”Shaping”
“trigger_threshold”:       “6sigma”,      # – trigger threshold. float or string of “x.xxsigma”
“trigger_threshold_deact”: 0.9,           # – trigger deactivate threshold. float, 0 to 1. Default is 1.
“trigger_align_max”:       True,          # – align trigger point to maximum after trigger cross-over. Default is true</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Shaping trigger</dt><dd><p>“trigger_type”:            “Shaping”,     # – trigger type: “Reshape”,”Random”,”Threshold”,”Shaping”
“trigger_kernel”:          “Gauss”,       # – trigger kernel: string, {“Gauss”,”Shaping”,”OF_dummy”,”OF”}.
“trigger_threshold”:       “6sigma”,      # – trigger threshold. float or string of “x.xxsigma”
“trigger_threshold_deact”:  0.9,          # – trigger deactivate threshold. float, 0 to 1. Default is 1.
“trigger_align_max”:        True,         # – align trigger point to maximum after trigger cross-over. Default is true
“trigger_kernel_dummy”:    [10e-6,30e-6], # – “Shaping” and “OF_dummy” kernel: Rise and fall time in us. Default is [10e-6,30e-6]
“trigger_kernel_gauss”:    [20,3],        # – “Gauss” kernel: Sigma an truncation (number of sigmas)
“trigger_kernel_OF”:       [170e3],       # – “OF kernel”: LPF [Hz]</p>
</dd>
</dl>
</li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._set_threshold">
<span class="sig-name descname"><span class="pre">_set_threshold</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">amplitude</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._set_threshold" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a trigger threshold</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger._set_trigger_parameters">
<span class="sig-name descname"><span class="pre">_set_trigger_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger._set_trigger_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>extract trigger information from channel_config</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger.process_metadata">
<span class="sig-name descname"><span class="pre">process_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i_trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger.process_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>process metadata, see io_user.process_metadata_user</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger.random_trigger">
<span class="sig-name descname"><span class="pre">random_trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_trace_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_random_per_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reshaping_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_overlaping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger.random_trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Return trigger points with three different options:
1. just reshaping
2. random trigger
3. random trigger without any possible overlaping</p>
<dl class="simple">
<dt>raw_trace_length: int</dt><dd><p>length of the trace that you want to find trigger points</p>
</dd>
<dt>N_random_per_file: int</dt><dd><p>number of random triggers per file</p>
</dd>
<dt>reshaping_only: boolean</dt><dd><p>Just reshaping if True</p>
</dd>
<dt>non_overlaping: boolean</dt><dd><p>No overlaping between traces if True</p>
</dd>
<dt>pre_trig,post_trig:int</dt><dd><p>pre trigger and post trigger samples</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>trigger_points,[],[]</em></p></li>
<li><p><strong>trigger_points</strong> (<em>array</em>) – Trigger position in the raw trace</p></li>
<li><p><strong>a_list_of_zeros</strong> (<em>array</em>) – An empty array, length equal to the trigger_points array</p></li>
<li><p><strong>a_list_of_zeros</strong> (<em>array</em>) – An empty array, length equal to the trigger_points array</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger.run_trigger">
<span class="sig-name descname"><span class="pre">run_trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">align_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strip_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_events</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">99999</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger.run_trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Run trigger and write RQs for metadata</p>
<dl class="simple">
<dt>align_max: boolean</dt><dd><p>Align peaks if True</p>
</dd>
<dt>return_traces: boolean</dt><dd><p>return traces if True</p>
</dd>
<dt>strip_result: boolean</dt><dd><p>return the index of trace triggered if True</p>
</dd>
<dt>max_events: int</dt><dd><p>The maximum number of events to process</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>traces</strong> (<em>dict</em>) – A dict with all the triggered traces on different channels.</p></li>
<li><p><strong>trigger_result</strong> (<em>dict</em>) – A dict of reduced quantities.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trigger.Trigger.threshold_trigger">
<span class="sig-name descname"><span class="pre">threshold_trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trig_th</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rising_edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">align_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deactivate_th</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_search_window_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_holdoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trigger.Trigger.threshold_trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the threshold trigger, align to the maximum point after the trigger cross-over
Return trigger points, trigger_amplitude and trigger width</p>
<dl class="simple">
<dt>trace: array</dt><dd><p>The trace to be triggered</p>
</dd>
<dt>trig_th: float</dt><dd><p>Trigger threshold</p>
</dd>
<dt>rising_edge: boolean</dt><dd><p>Trigger on rising edge if Ture, on falling edge if False.</p>
</dd>
<dt>align_max: boolean</dt><dd><p>Align the peaks if True</p>
</dd>
<dt>deactivate_th: float</dt><dd><p>Deactivate threshold: close the window for trigger point search. It’s the multiple of trig_th.
Example: if trig_th is 1.8eV and you want deactivate threshold to be 0.9eV, set deactivate_th=0.5
Defualt setting None if you want deactivate_th=trig_th</p>
</dd>
<dt>peak_search_window_limit:int</dt><dd><p>The limit for peak search window</p>
</dd>
<dt>trigger_holdoff: int</dt><dd><p>The counts (<em>not time</em>) before next trigger point</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>trigger_points,trigger_amplitude,trigger_widths</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="cut-methods">
<h2>Cut methods<a class="headerlink" href="#cut-methods" title="Permalink to this heading">¶</a></h2>
<p>The _cut.py script includes a function that removes outliers with statistical methods.</p>
<span class="target" id="module-pycrp._cut"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._cut.Cut">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._cut.</span></span><span class="sig-name descname"><span class="pre">Cut</span></span><a class="headerlink" href="#pycrp._cut.Cut" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py class">
<dt class="sig sig-object py" id="pycrp._cut.Cut._UnbiasedEstimators">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_UnbiasedEstimators</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lwrbnd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uprbnd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._cut.Cut._UnbiasedEstimators" title="Permalink to this definition">¶</a></dt>
<dd><p>//From QETpy: <a class="reference external" href="https://github.com/ucbpylegroup/QETpy">https://github.com/ucbpylegroup/QETpy</a>
Helper class for calculating the unbiased estimators of a 1D normal
distribution that has been truncated at specified bounds.
.. attribute:: mu0</p>
<blockquote>
<div><p>The biased estimator of the mean of the inputted and truncated data.</p>
<dl class="field-list simple">
<dt class="field-odd">type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</div></blockquote>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._cut.Cut._UnbiasedEstimators.std0">
<span class="sig-name descname"><span class="pre">std0</span></span><a class="headerlink" href="#pycrp._cut.Cut._UnbiasedEstimators.std0" title="Permalink to this definition">¶</a></dt>
<dd><p>The biased estimator of the standard deviation of the inputted and
truncated data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._cut.Cut._UnbiasedEstimators.mu">
<span class="sig-name descname"><span class="pre">mu</span></span><a class="headerlink" href="#pycrp._cut.Cut._UnbiasedEstimators.mu" title="Permalink to this definition">¶</a></dt>
<dd><p>The unbiased estimator of the mean of the inputted and truncated data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._cut.Cut._UnbiasedEstimators.std">
<span class="sig-name descname"><span class="pre">std</span></span><a class="headerlink" href="#pycrp._cut.Cut._UnbiasedEstimators.std" title="Permalink to this definition">¶</a></dt>
<dd><p>The unbiased estimator of the standard deviation of the inputted and
truncated data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._cut.Cut._UnbiasedEstimators._calc_unbiased_estimators">
<span class="sig-name descname"><span class="pre">_calc_unbiased_estimators</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._cut.Cut._UnbiasedEstimators._calc_unbiased_estimators" title="Permalink to this definition">¶</a></dt>
<dd><p>Method for calculating the unbiased estimators of the truncated distribution.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._cut.Cut._UnbiasedEstimators._equations">
<span class="sig-name descname"><span class="pre">_equations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._cut.Cut._UnbiasedEstimators._equations" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper method for calculating the system of equations that will be
numerically solved for find the unbiased estimators.
:param p: A tuple of length 2 containing the current estimated values of the</p>
<blockquote>
<div><p>unbiased estimators: (mu, std).</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>(mu_eqn, std_eqn)</strong> – A tuple containing the two equations that will be solved to give the
unbiased estimators of the mean and standard deviation of the data.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tuple</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._cut.Cut.removeoutliers">
<span class="sig-name descname"><span class="pre">removeoutliers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skew_target</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skew_itermax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_target</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_itermax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_unbiased_estimates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._cut.Cut.removeoutliers" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Removing outliers by</dt><dd><ol class="arabic simple">
<li><p>skewness (minimizing to skewtarget)</p></li>
<li><p>standard deviation</p></li>
</ol>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em>) – Array of real-valued variables from which to remove outliers.</p></li>
<li><p><strong>skew_target</strong> (<em>float</em>) – The limit for skewness cut. Defealt value is 0.05</p></li>
<li><p><strong>skew_itermax</strong> (<em>int</em>) – The maximum number of traces cut by skewness.</p></li>
<li><p><strong>std_target</strong> (<em>float</em>) – The limit for the standard deviation cut. Defealt value is 3</p></li>
<li><p><strong>std_itermax</strong> (<em>int</em>) – The maximum number of traces cut by standard deviation.</p></li>
<li><p><strong>std_precision</strong> (<em>float</em>) – A factor that converts deviation to standard deviation</p></li>
<li><p><strong>return_unbiased_estimates</strong> (<em>Boolean</em>) – Return the unbiased estimates if True. For example, mu and S square</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Not used</p></li>
<li><p><strong>verbose</strong> (<em>Boolean</em>) – Print the debugging messages if True</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>inds</strong> – Boolean indices</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="id4">
<h2>Midas<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<p>Functions to load NEXUS midas data directly with midas python interface.</p>
<span class="target" id="module-pycrp._midas"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._midas.</span></span><span class="sig-name descname"><span class="pre">Midaspy</span></span><a class="headerlink" href="#pycrp._midas.Midaspy" title="Permalink to this definition">¶</a></dt>
<dd><p>A Class to load NEXUS midas data directly with midas python interface
It is roughly twice as fast as rawio</p>
<dl class="simple">
<dt>WARNING: USE AT YOUR OWN RISK!</dt><dd><p>This implementation bypasses the official IOLibrary
It does NOT support multiple format versions.
It does NOT handel all corner cases well.
It supports data with only one “detector” and validated with NEXUS data</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_CHANNEL_NUMBER">
<span class="sig-name descname"><span class="pre">MASK_CHANNEL_NUMBER</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">60</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_CHANNEL_NUMBER" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_CHANNEL_TYPE">
<span class="sig-name descname"><span class="pre">MASK_CHANNEL_TYPE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_CHANNEL_TYPE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_N_PRIMS">
<span class="sig-name descname"><span class="pre">MASK_N_PRIMS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">268435455</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_N_PRIMS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_READOUT_TYPE">
<span class="sig-name descname"><span class="pre">MASK_READOUT_TYPE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4294967040</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_READOUT_TYPE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_TRIG_TYPE">
<span class="sig-name descname"><span class="pre">MASK_TRIG_TYPE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">255</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_TRIG_TYPE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_TriggerTime_100ns">
<span class="sig-name descname"><span class="pre">MASK_TriggerTime_100ns</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">16777215</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_TriggerTime_100ns" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.MASK_TriggerTime_second">
<span class="sig-name descname"><span class="pre">MASK_TriggerTime_second</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4294901760</span></em><a class="headerlink" href="#pycrp._midas.Midaspy.MASK_TriggerTime_second" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.append_dicts_traces">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">append_dicts_traces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.append_dicts_traces" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.getEventInfo">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getEventInfo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">files_series</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.getEventInfo" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Required input:</dt><dd><ol class="arabic simple">
<li><p>filepath: path to file or series directory (can be empty string)</p></li>
<li><dl class="simple">
<dt>files_series: file name(s) (string or list of string)</dt><dd><p>or series number(s) (string or list of string)</p>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
<p>Note: eventNumbers can only be used with a single series
(“files_series” must be a string)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.getRawEvents">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getRawEvents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">files_series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eventNumbers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelList</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.getRawEvents" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Required input:</dt><dd><ol class="arabic simple">
<li><p>filepath: path to file or series directory (can be empty string)</p></li>
<li><dl class="simple">
<dt>files_series: file name(s) (string or list of string)</dt><dd><p>or series number(s) (string or list of string)</p>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
<p>Note: eventNumbers can only be used with a single series
(“files_series” must be a string)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.read_file">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">EventNumber</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unpack_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unpack_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.read_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.read_series">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read_series</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">EventNumber</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.read_series" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.read_series_info">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read_series_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.read_series_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._midas.Midaspy.unpack_event">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">unpack_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unpack_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unpack_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.Midaspy.unpack_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Only for one detector!</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pycrp._midas.use_local_midas">
<span class="sig-prename descclassname"><span class="pre">pycrp._midas.</span></span><span class="sig-name descname"><span class="pre">use_local_midas</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._midas.use_local_midas" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="noise">
<h2>Noise<a class="headerlink" href="#noise" title="Permalink to this heading">¶</a></h2>
<p>Calculate the amplitude spectral density of noise traces.The unit is <em>pA/sqrt(Hz)</em>, but named PSD, Power Spectral Density, in the code for historical reason. Usually PSDs have the unit of <em>sq(W)/Hz</em>).</p>
<p>You can also simulate a Gaussian noise with given noise PSD by <code class="docutils literal notranslate"><span class="pre">get_noise_trace()</span></code>, and plot the PSD by <code class="docutils literal notranslate"><span class="pre">plotPSD()</span></code></p>
<span class="target" id="module-pycrp._noise"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._noise.Noise">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._noise.</span></span><span class="sig-name descname"><span class="pre">Noise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'constant'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>traces</strong> (<em>list</em><em> or </em><em>ndarray</em><em> or </em><em>dict</em>) – Triggered traces to be processed.</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling frequency.</p></li>
<li><p><strong>trace_weight</strong> (<em>float</em>) – A number multiplied to the traces, usually used for unit convertion.</p></li>
<li><p><strong>chan_names</strong> (<em>list</em>) – Channel names</p></li>
<li><p><strong>window</strong> (<em>str</em><em> or </em><em>tuple</em><em> or </em><em>array_like</em><em>, </em><em>optional</em>) – Desired window to use for scipy.signal.periodogram</p></li>
<li><p><strong>verbose</strong> (<em>boolean</em>) – Print datasize if True</p></li>
<li><p><strong>detrend</strong> (<em>{&quot;linear&quot;</em><em>, </em><em>&quot;constant&quot;}</em>) – Specifies how to detrend each segment. This is an input for scipy.signal.periodogram</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise._check_data">
<span class="sig-name descname"><span class="pre">_check_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise._check_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise._set_data">
<span class="sig-name descname"><span class="pre">_set_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise._set_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Private method for converting different format of traces into a dictionary.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise.calc_csd">
<span class="sig-name descname"><span class="pre">calc_csd</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise.calc_csd" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Cross Spectrum Density of traces.
Note: It’s here for no reason. Can I just delete this block?</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise.calc_psd">
<span class="sig-name descname"><span class="pre">calc_psd</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise.calc_psd" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Power Spectrum Density of traces.
Note: It’s actually Amplitude Spectrum Density(Unit: pA/sqrt(Hz)), but people used to call it PSD(Unit: sq(pA)/Hz).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise.calc_uncorr_noise">
<span class="sig-name descname"><span class="pre">calc_uncorr_noise</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise.calc_uncorr_noise" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise.get_noise_trace">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_noise_trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'convert'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise.get_noise_trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Create Gaussian noise with given noise PSD (power spectral density)</p>
<dl class="simple">
<dt>psd: array</dt><dd><p>One-sided power density spectrum</p>
</dd>
<dt>n_traces: int</dt><dd><p>number of traces</p>
</dd>
<dt>trace_length: int or none</dt><dd><p>If None, automatically calculate by the PSD length.</p>
</dd>
<dt>Fs: int</dt><dd><p>Sampling frequency.</p>
</dd>
<dt>method: “filter” or “convert”</dt><dd><dl class="simple">
<dt>“filter”: [ERROR in calculation, need fix] A white noise is generated and using the psd as FIR filter.</dt><dd><p>can generate noise trace with arbiturary length.</p>
</dd>
<dt>“convert”: Pulling a sample using the psd as pdf directly. Can only generate</dt><dd><p>trace that has same length as psd.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>traces</strong> – The simulated noise traces</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>2-d array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._noise.Noise.plotPSD">
<span class="sig-name descname"><span class="pre">plotPSD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sep_plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_band</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._noise.Noise.plotPSD" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the PSD for channels from dictionary input.</p>
<dl class="simple">
<dt>psds: dict</dt><dd><p>Keys: str, Channel names.
Values: list, power at different frequencies. i.e. p(f)</p>
</dd>
<dt>f: list</dt><dd><p>Frequency</p>
</dd>
<dt>channels: list of str</dt><dd><p>List of channels</p>
</dd>
<dt>sep_plots: boolean</dt><dd><p>Does nothing</p>
</dd>
<dt>show_band: boolean</dt><dd><p>Must be False now. psds_median and psds_iqr_l are not defined.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="optimum-filter">
<h2>Optimum Filter<a class="headerlink" href="#optimum-filter" title="Permalink to this heading">¶</a></h2>
<p>Apply Optimum Filter on traces.</p>
<span class="target" id="module-pycrp._optimum_filter"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._optimum_filter.FIR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._optimum_filter.</span></span><span class="sig-name descname"><span class="pre">FIR</span></span><a class="headerlink" href="#pycrp._optimum_filter.FIR" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.FIR.butter_filter">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">butter_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">625000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forward_backward</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.FIR.butter_filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.FIR.impz">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">impz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.FIR.impz" title="Permalink to this definition">¶</a></dt>
<dd><p>#Plot step and impulse response</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.FIR.mfreqz">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">mfreqz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4095</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_phase</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.FIR.mfreqz" title="Permalink to this definition">¶</a></dt>
<dd><p>#Plot frequency and phase response</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._optimum_filter.</span></span><span class="sig-name descname"><span class="pre">OptimalFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter._argmin_chi2">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_argmin_chi2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chi2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter._argmin_chi2" title="Permalink to this definition">¶</a></dt>
<dd><p>Find index of the minimum of chi2.</p>
<dl class="simple">
<dt>chi2<span class="classifier">ndarray</span></dt><dd><p>An array of chi2, 1-D or 2-D. If dimension ==2, finding minimum across the whole matrix
axis.</p>
</dd>
<dt>window<span class="classifier">None, int</span></dt><dd><p>“window” specify the region for minimization. Default is None, which means unlimited region.</p>
</dd>
<dt>mask<span class="classifier">None, boolean array</span></dt><dd><p>Additional boolean mask to constrain the region for minimization. It should have the same shape as chi2.
Default is None, no cut applied.</p>
</dd>
<dt>interp: boolean</dt><dd><p>If true, use parabola interpolation.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>ind</strong> – The index of the minimum of <cite>chi2</cite> with the constraints of <cite>window</cite> and <cite>mask</cite>.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tuple, list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.calc_chi2_lim">
<span class="sig-name descname"><span class="pre">calc_chi2_lim</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OF'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">100000.0]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.calc_chi2_lim" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate a frequency domain chi2 with frequency range different than what’s used in the fit</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.calc_fitted_trace">
<span class="sig-name descname"><span class="pre">calc_fitted_trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OF'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.calc_fitted_trace" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the fitted trace</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.calc_lpf">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calc_lpf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.calc_lpf" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the bin number of the low pass filter</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.energy_resolution">
<span class="sig-name descname"><span class="pre">energy_resolution</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.energy_resolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Get amplitude resolution of Optimal Filter
See README.md in pycrp/processing for the derivation</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>sigma</strong> – The amplitude resolution of the Optimal filter.
unit is [uA], which depends on the unit of noise psd</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.of_amp">
<span class="sig-name descname"><span class="pre">of_amp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">S</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF_OFP</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_all</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OFP_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OFP_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.of_amp" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>S</strong> (<em>1d array</em><em>,</em>) – signal in time domain, [uA]</p></li>
<li><p><strong>N</strong> (<em>1d array</em><em> or </em><em>None</em>) – noise PSD
If None, use the stored PSD of this instance [pA/rtHz]</p></li>
<li><p><strong>T</strong> (<em>1d array</em><em> or </em><em>None</em>) – pulse shape template [Normalized to amplitude of 1]
If None, use the stored pulse shape of this instance</p></li>
<li><p><strong>fs</strong> (<em>float</em><em>, </em><em>sampling frequency</em>) – </p></li>
<li><p><strong>delay</strong> (<em>int t1</em><em>, or </em><em>a pair of int</em><em> [</em><em>t1</em><em>,</em><em>t2</em><em>]</em><em>.</em>) – If -1, search whole trace
If t1, the chi2 minimization is done within +/-t1 samples
If [t1,t2],the chi2 minimization is done from -t1 to +t2 samples</p></li>
<li><p><strong>LPF</strong> (<em>float</em><em> [</em><em>Hz</em><em>]</em><em>, or </em><em>None</em>) – cut-off frequency for chi2 evaluation. (No need to calcuate the bins again!)
set to None to disable LPF</p></li>
<li><p><strong>OFP_length</strong> (<em>int</em>) – if -1: DISABLE pile-up optimal filter
if &gt;0: ENABLE pile-up optimal filter. this number set the window lenght of OFP</p></li>
<li><p><strong>OFP_threshold</strong> (<em>float</em>) – the pulse amplitude threshold for OFP, to prevent finding minimum due to fluctuation
Recommand to set at 7-sigma of baseline resolution</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>(OF0, OF, OFL, OFP)</em></p></li>
<li><p><em>if return_all and OFP_length&gt;0 type(delay) is not list and delay!=0 and delay!=-1</em> – return (A0,Xr0), (A,Xr,t0), (A_lim,Xr_lim,t0_lim),(A1s,A2s,t1,t2,Xrp) (OF0, OF, OFL)</p></li>
</ul>
</p>
</dd>
</dl>
<dl class="simple">
<dt>if return_all and type(delay) is not list and delay!=0 and delay!=-1:</dt><dd><p>return (A0,Xr0), (A,Xr,t0), (A_lim,Xr_lim,t0_lim) (OF0 only)</p>
</dd>
<dt>if type(delay) is not list and delay==0:</dt><dd><p>return A0,Xr0,0 (OF only)</p>
</dd>
<dt>elif type(delay) is not list and delay==-1:</dt><dd><p>return A,Xr,t0 (OFL only)</p>
</dd>
<dt>else:</dt><dd><p>return A_lim,Xr_lim,t0_lim</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.of_coeff">
<span class="sig-name descname"><span class="pre">of_coeff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.of_coeff" title="Permalink to this definition">¶</a></dt>
<dd><p>Set OF coefficient</p>
<dl class="simple">
<dt>N: ndarray</dt><dd><p>Current noise psd, [pA/sqrt(Hz)]</p>
</dd>
<dt>T: ndarray</dt><dd><p>Pulse shape tempalte, amplitude normalized to 1</p>
</dd>
<dt>LPF: float [Hz], or None</dt><dd><p>cut-off frequency for chi2 evaluation. No need to calcuate the bins again!
set to None to disable LPF</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>self.OF_coeff</strong> – The optimum filter coefficients</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.of_coeff_OFP">
<span class="sig-name descname"><span class="pre">of_coeff_OFP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.of_coeff_OFP" title="Permalink to this definition">¶</a></dt>
<dd><p>Set OF coefficient</p>
<dl class="simple">
<dt>N: ndarray</dt><dd><p>Current noise psd, [pA/sqrt(Hz)]</p>
</dd>
<dt>T: ndarray</dt><dd><p>Pulse shape tempalte, amplitude normalized to 1</p>
</dd>
<dt>LPF: float [Hz], or None</dt><dd><p>cut-off frequency for chi2 evaluation. No need to calcuate the bins again!
set to None to disable LPF</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>self.OF_coeff_OFP</strong> – The pile up optimum filter coefficients</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.timeMatrix">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">timeMatrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.timeMatrix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.timeShiftMatrix">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">timeShiftMatrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.timeShiftMatrix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.time_resolution">
<span class="sig-name descname"><span class="pre">time_resolution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">amp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.time_resolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Get time resolution of Optimal filter at a given amplitude
See README.md in pycrp/processing for the derivation</p>
<dl class="simple">
<dt>amp<span class="classifier">float, [uA]</span></dt><dd><p>The amplitude to use in the time resolution calculation.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>sigma</strong> – The time resolution of the optimum filter.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter.unwrap_dt">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">unwrap_dt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_length</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter.unwrap_dt" title="Permalink to this definition">¶</a></dt>
<dd><p>unwrap the OF time with window_length (full window length, 2*OFP_window)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter_ana">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._optimum_filter.</span></span><span class="sig-name descname"><span class="pre">OptimalFilter_ana</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'3pole'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flat'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ac_coupling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">625000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter_ana" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit an analytical function to a pulse in frequency domain with given noise PSD</p>
<dl class="simple">
<dt>psd<span class="classifier">ndarray</span></dt><dd><p>The power spectral density of noise, normalized to pA/rtHz
!! ATTENTION !! must be one-sided (with positive frequency only)</p>
</dd>
<dt>trace: ndarray</dt><dd><p>The pulse to fit</p>
</dd>
<dt>template: {“2pole”,”3pole”,”4pole”}</dt><dd><p>The function of pulse shape template.
2pole: 1 rise time and 1 fall time</p>
</dd>
<dt>baseline: {“flat”,”exp”}</dt><dd><p>The function of baseline shape</p>
</dd>
<dt>ac_coupling: boolean</dt><dd><p>Whether DC is considered in the fit or not
Default: True (AC coupling)</p>
</dd>
<dt>Fs<span class="classifier">int or float</span></dt><dd><p>The sampling rate of the ADC</p>
</dd>
<dt>freqs<span class="classifier">ndarray</span></dt><dd><p>Frequencies bin centers of FFT</p>
</dd>
<dt>times<span class="classifier">ndarray</span></dt><dd><p>Time bins corresponding to the pulse</p>
</dd>
<dt>popt<span class="classifier">dict</span></dt><dd><p>The best-fit parameters</p>
</dd>
<dt>chi2<span class="classifier">float</span></dt><dd><p>Reduced chi2 in frequency domain</p>
</dd>
<dt>DOF<span class="classifier">int</span></dt><dd><p>The number of degrees of freedom in the fit</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter_ana.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Powell'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter_ana.fit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter_ana.pulseshape_freq">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pulseshape_freq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter_ana.pulseshape_freq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter_ana.pulseshape_freq_x">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pulseshape_freq_x</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freqs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter_ana.pulseshape_freq_x" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter_ana.pulseshape_time">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pulseshape_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter_ana.pulseshape_time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._optimum_filter.OptimalFilter_ana.pulseshape_time_int">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pulseshape_time_int</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_f3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._optimum_filter.OptimalFilter_ana.pulseshape_time_int" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="reduced-quantities-rqs">
<h2>Reduced Quantities (RQs)<a class="headerlink" href="#reduced-quantities-rqs" title="Permalink to this heading">¶</a></h2>
<p>Calculates the RQs of a given event. See <a class="reference external" href="https://gitlab.com/supercdms/Analysis/pyCRP/-/blob/master/docs/RQs.md">the list of RQs</a> for details.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp._rq.RQ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._rq.</span></span><span class="sig-name descname"><span class="pre">RQ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">PSDs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Templates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the data with Optimal filter and calculte RQs</p>
<dl class="simple">
<dt>PSDs: dict</dt><dd><p>The PSDs of data</p>
</dd>
<dt>Templates: dict</dt><dd><p>The pulse templates</p>
</dd>
<dt>config: dict</dt><dd><p>The configuration information</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.filter_trace">
<span class="sig-name descname"><span class="pre">filter_trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.filter_trace" title="Permalink to this definition">¶</a></dt>
<dd><p>For only one trace</p>
<dl class="simple">
<dt>Trace: array</dt><dd><p>raw trace</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>Traces</strong> – The traces after filtering</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.filter_traces">
<span class="sig-name descname"><span class="pre">filter_traces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Traces</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.filter_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>For multiple traces</p>
<dl class="simple">
<dt>Traces: dict</dt><dd><p>raw traces</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>Traces</strong> – The traces after filtering</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.init_OF">
<span class="sig-name descname"><span class="pre">init_OF</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.init_OF" title="Permalink to this definition">¶</a></dt>
<dd><p>Instantiate a OF class for each channel</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.matchedFilter">
<span class="sig-name descname"><span class="pre">matchedFilter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">S</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.matchedFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Take two arrays as input and apply matched filter</p>
<dl class="simple">
<dt>S: array</dt><dd><p>The first array</p>
</dd>
<dt>T: array</dt><dd><p>The second array</p>
</dd>
<dt>threshold:</dt><dd><p>threshould for the first array</p>
</dd>
<dt>cut: array</dt><dd><p>A mask for cutting. Set to any non-array type to disable.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>A_t</strong> – The traces after filtering</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.other_RQs">
<span class="sig-name descname"><span class="pre">other_RQs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Traces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">STRIP_RQs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.other_RQs" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute other non-OF reduced quantities</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.process_traces">
<span class="sig-name descname"><span class="pre">process_traces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Traces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">STRIP_RQs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.process_traces" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Traces: dict</dt><dd><p>raw traces (continuous stream)</p>
</dd>
<dt>trigger_result: dict</dt><dd><p>trigger results</p>
</dd>
<dt>STRIP_RQs: boolean</dt><dd><p>A flag to strip RQs</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>res</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._rq.RQ.run_OF">
<span class="sig-name descname"><span class="pre">run_OF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Traces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">STRIP_RQs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._rq.RQ.run_OF" title="Permalink to this definition">¶</a></dt>
<dd><p>Run optimal filter and compute reduced quantities(RQs)</p>
<dl class="simple">
<dt>Traces: dict</dt><dd><p>raw traces (continuous stream)</p>
</dd>
<dt>trigger_result: dict</dt><dd><p>trigger results</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>OF_results</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="trace">
<h2>Trace<a class="headerlink" href="#trace" title="Permalink to this heading">¶</a></h2>
<p>Converting different format of traces into a dictionary.</p>
<p>Optional to cut traces based on average, slope, skewness and range. Those cut can reject the raw traces with pulses, so the noise spectrum will be more precise.</p>
<span class="target" id="module-pycrp._trace"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._trace.Pileup">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._trace.</span></span><span class="sig-name descname"><span class="pre">Pileup</span></span><a class="headerlink" href="#pycrp._trace.Pileup" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup._create_pileup">
<span class="sig-name descname"><span class="pre">_create_pileup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup._create_pileup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup.create_pileup">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_pileup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolation_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolation_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup.create_pileup" title="Permalink to this definition">¶</a></dt>
<dd><p>Create 2-pulses pileup with given time and amplitude.
Update 2021/7/2: the interpolation is replaced with rolling by fft</p>
<dl class="simple">
<dt>template: list</dt><dd><p>pulse shape template</p>
</dd>
<dt>t1,t2,a1,a2: float</dt><dd><p>time [sample] and amplitude [uA] of two pulses</p>
</dd>
<dt>psd: list (optional)</dt><dd><p>Noise PSD, must have compatible length as the template</p>
</dd>
<dt>interpolation_threshold: float</dt><dd><p>If the time difference abs(t1-t2) is within interpolation_threshold, interpolation is enabled.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>y</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>a pileup trace</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup.init">
<span class="sig-name descname"><span class="pre">init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">625000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LPF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup.init" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup.least_square_freq">
<span class="sig-name descname"><span class="pre">least_square_freq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup.least_square_freq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup.least_square_scipy">
<span class="sig-name descname"><span class="pre">least_square_scipy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup.least_square_scipy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup.least_square_time">
<span class="sig-name descname"><span class="pre">least_square_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup.least_square_time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Pileup.run_fit">
<span class="sig-name descname"><span class="pre">run_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lim_t</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lim_a</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolation_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Pileup.run_fit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pycrp._trace.Trace">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._trace.</span></span><span class="sig-name descname"><span class="pre">Trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'constant'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Trunk and cut traces from raw data</p>
<p>traces: dict of array</p>
<dl class="simple">
<dt>fs: float</dt><dd><p>Sampling frequency</p>
</dd>
<dt>trace_weight: float</dt><dd><p>A factor to scale the traces.</p>
</dd>
<dt>chan_names: list</dt><dd><p>List of channel names.</p>
</dd>
<dt>window: None</dt><dd><p>Not used yet</p>
</dd>
<dt>verbose: boolean</dt><dd><p>Print data size if True.</p>
</dd>
<dt>detrend: str</dt><dd><p>Not used yet.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace._apply_mask">
<span class="sig-name descname"><span class="pre">_apply_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace._apply_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the mask to data</p>
<dl class="simple">
<dt>data: array</dt><dd><p>mean, slope, skew, range, etc. of the raw trace.</p>
</dd>
<dt>pre_mask: boolean array</dt><dd><p>mask applied on data.</p>
</dd>
<dt>max_iter: int</dt><dd><p>maximum number of iterations.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>mask</strong> – A mask base on the cut</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>boolean array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace._combine_channel_cuts">
<span class="sig-name descname"><span class="pre">_combine_channel_cuts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace._combine_channel_cuts" title="Permalink to this definition">¶</a></dt>
<dd><p>Combine all the mask. For example [True, True, False]&amp;[True, True, True]&amp;[False, True, True] will be[False, True, False]</p>
<dl class="simple">
<dt>mask: list of boolean array</dt><dd><p>mask to be combined</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>mask</strong> (<em>boolean array</em>) – combined mask</p></li>
<li><p><em>—</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace._set_data">
<span class="sig-name descname"><span class="pre">_set_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace._set_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Private method for converting different format of traces into a dictionary.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.autocut_psd">
<span class="sig-name descname"><span class="pre">autocut_psd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simultaneous_cut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gauss:20,0'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.autocut_psd" title="Permalink to this definition">¶</a></dt>
<dd><p>Selecting events that has no pulses</p>
<p>Auto cut traces based on 4 parameters:
average, slope, skewness and range</p>
<dl class="simple">
<dt>traces: dict of arrays</dt><dd><p>Events with pulses.</p>
</dd>
<dt>simultaneous_cut: boolean</dt><dd><p>if True: simultaneously cut on all channels.</p>
</dd>
<dt>max_iter: int</dt><dd><p>Maximum number of iterations for the cut.</p>
</dd>
<dt>ds: int</dt><dd><p>Downsampling factor.</p>
</dd>
<dt>use_filter: str</dt><dd><p>the filter applied on the traces before cut. Default is “gauss:20,0”.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>traces</strong> – Events with pulses removed.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict of arrays</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.autocut_pulse">
<span class="sig-name descname"><span class="pre">autocut_pulse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simultaneous_cut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.autocut_pulse" title="Permalink to this definition">¶</a></dt>
<dd><p>Auto cut traces based on 4 parameters:
average, slope, skewness and range
Two more cuts are to be implemented: pileup and chi2</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_amplitude">
<span class="sig-name descname"><span class="pre">cut_amplitude</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reject_low_amplitude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low_amplitude_sigmas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_amplitude" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut on the amplitude (maximum - mean_baseline)</p>
<dl class="simple">
<dt>pre_trig: int or float</dt><dd><p>if int: specify the index of the end of pre_trig region
if float (default): specify the percentage of trace that is considered baseline (0.5 means half of the trace)</p>
</dd>
<dt>max_iter: int</dt><dd><p>maximum iterations when doing auto cut, default =20</p>
</dd>
<dt>reject_low_amplitude: boolean</dt><dd><p>Whether to reject the low amplitude events. When you want to keep events with pulses but noise triggers are dominating, this can be useful.</p>
</dd>
<dt>low_amplitude_sigmas: float</dt><dd><p>Amplitude within how many stds of baseline should be removed.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>mask</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict of boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_chi2">
<span class="sig-name descname"><span class="pre">cut_chi2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_chi2" title="Permalink to this definition">¶</a></dt>
<dd><p>cut on chi2 (2-pole pulse shape fit)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_mean">
<span class="sig-name descname"><span class="pre">cut_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_mean" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut on the mean (average).</p>
<dl class="simple">
<dt>pre_trig: int or float</dt><dd><p>if int: specify the index of the end of pre_trig region
if float (default): specify the percentage of trace that is considered baseline (0.5 means half of the trace)</p>
</dd>
<dt>max_iter: int</dt><dd><p>maximum iterations when doing auto cut, default =20</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>mask</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict of boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_pileup">
<span class="sig-name descname"><span class="pre">cut_pileup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_pileup" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut on the pileup pulses</p>
<dl class="simple">
<dt>pre_trig: int or float</dt><dd><p>if int: specify the index of the end of pre_trig region
if float (default): specify the percentage of trace that is considered baseline (0.5 means half of the trace)</p>
</dd>
<dt>threshold_sigma:</dt><dd><p>Detection threshold of pileup pulses</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>mask</strong> (<em>dict of boolean</em>)</p></li>
<li><p><em>—</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_range">
<span class="sig-name descname"><span class="pre">cut_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut on the range (maximum - minimum)</p>
<dl class="simple">
<dt>pre_trig: int or float</dt><dd><p>if int: specify the index of the end of pre_trig region
if float (default): specify the percentage of trace that is considered baseline (0.5 means half of the trace)</p>
</dd>
<dt>max_iter: int</dt><dd><p>maximum iterations when doing auto cut, default =20</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>mask</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict of boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_skew">
<span class="sig-name descname"><span class="pre">cut_skew</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_skew" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut on the skewness (use scipy.stats.skew to calculate it).</p>
<dl class="simple">
<dt>pre_trig: int or float</dt><dd><p>if int: specify the index of the end of pre_trig region
if float (default): specify the percentage of trace that is considered baseline (0.5 means half of the trace)</p>
</dd>
<dt>max_iter: int</dt><dd><p>maximum iterations when doing auto cut, default =20</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>mask</strong> (<em>dict of boolean</em>)</p></li>
<li><p><em>—</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.cut_slope">
<span class="sig-name descname"><span class="pre">cut_slope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.cut_slope" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut on the slope (use scipy.stats.linregress to calculate it).</p>
<dl class="simple">
<dt>pre_trig: int or float</dt><dd><p>if int: specify the index of the end of pre_trig region
if float (default): specify the percentage of trace that is considered baseline (0.5 means half of the trace)</p>
</dd>
<dt>max_iter: int</dt><dd><p>maximum iterations when doing auto cut, default =20</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>mask</strong></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict of boolean</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.filter_data">
<span class="sig-name descname"><span class="pre">filter_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gauss:20,0'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.filter_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter and downsample the data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>int</em>) – down-sampling factor, default = 4</p></li>
<li><p><strong>use_filter</strong> (<em>boolean</em><em> or </em><em>str</em>) – False: no filtering
“savgol:<cite>length</cite>,`order`”: use Savgol filter, <cite>length</cite> and <cite>order</cite> should be int
“gauss:<cite>sigma</cite>,`order`”: use Gauss filter, <cite>sigma</cite> and <cite>order</cite> should be int
default is “gauss:20,0”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.get_traces">
<span class="sig-name descname"><span class="pre">get_traces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Series</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_pattern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NEXUS'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">USER_IO_FILENAME</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">312500</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/sdf/group/supercdms/data/CDMS/NEXUS/R8/Raw'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ADC2uA</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">templates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PSDs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filelist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.get_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper function of Trigger.run_trigger().
Run trigger on multiple files.
Without this wrapper, the trigger can be ran by following steps:</p>
<blockquote>
<div><dl class="simple">
<dt>def ADC2uA_NEXUSR7(x):</dt><dd><p>return x/2**16 <a href="#id5"><span class="problematic" id="id6">*</span></a>8.192*1e6 / 4/2100/14</p>
</dd>
</dl>
<p>ADC2uA = ADC2uA_NEXUSR7(1)
transform = lambda x: -(x-32768)*ADC2uA</p>
<p>tg=ivpsd.Trigger(res,channel_config,transform=transform)
tg._make_filter_kernels()
traces, trigger_result = tg.run_trigger()</p>
</div></blockquote>
<p>Series: list of series string, used when filename_pattern is f-string like</p>
<dl class="simple">
<dt>filename_pattern: str, can be either</dt><dd><ul class="simple">
<li><p>full filename</p></li>
<li><p>series number, need to specify data_dir and data_type</p></li>
<li><p>a string with wildcard</p></li>
<li><p>a string with f-string format and with wildcard with “series” as a variable, and provide a list of series <cite>Series</cite>
Note that it should be given as a normal string, without the initial f’’. for example, “/{series}/{series}_F*.mid.gz”</p></li>
</ul>
</dd>
<dt>N_files: None, int, tuple or list</dt><dd><ul class="simple">
<li><p>None: return all filenames of this series</p></li>
<li><p>int N: return N filenames starting from the first one</p></li>
<li><p>tuple (N1,N2): return the N1^th to N2^th filenames</p></li>
<li><p>list: return the filenames following the indices in the list</p></li>
</ul>
</dd>
</dl>
<p>data_type: str, choose one from (“NEXUS”,”Animal”, “UMass”, “MIT”, “Argonne”,”RQ”)</p>
<dl class="simple">
<dt>trace_length: int</dt><dd><p>Length of the trace</p>
</dd>
<dt>pre_trig: int</dt><dd><p>Pre trigger length</p>
</dd>
<dt>data_dir: str</dt><dd><p>Raw data directory</p>
</dd>
<dt>ADC2uA: float</dt><dd><p>Convert DAQ reading to uA</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>traces</strong> (<em>array</em>) – Triggered raw traces</p></li>
<li><p><strong>trigger_info</strong> (<em>dict</em>) – trigger information</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._trace.Trace.get_traces_noise">
<span class="sig-name descname"><span class="pre">get_traces_noise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename_pattern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Series</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NEXUS'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">USER_IO_FILENAME</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/sdf/group/supercdms/data/CDMS/NEXUS/R8/Raw'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">312500</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ADC2uA</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simultaneous_cut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_cut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">true_random</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">true_random_multi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PSD_FILES</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._trace.Trace.get_traces_noise" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper function of get_traces(), specially for getting random triggered traces and autocut for PSD use</p>
<dl class="simple">
<dt>filename_pattern: str</dt><dd><p>See the <cite>IO</cite> class</p>
</dd>
<dt>N_files: int</dt><dd><p>Number of files to use</p>
</dd>
<dt>trace_length: int</dt><dd><p>Trace length</p>
</dd>
<dt>channel_config: dict() or None</dt><dd><p>Channel configuration dictionary. If not provided, will return random traces for all channels</p>
</dd>
<dt>max_iter: int</dt><dd><p>Maximum iteration in the autocut</p>
</dd>
<dt>simultaneous_cut: Boolean</dt><dd><p>If true, cut on all channels at the same time</p>
</dd>
<dt>auto_cut: boolean</dt><dd><p>Whether to do auto cut or not</p>
</dd>
<dt>verbose: boolean</dt><dd><p>Enable the print of information if true</p>
</dd>
<dt>data_dir: str</dt><dd><p>Where the raw data is. see the <cite>IO</cite> class</p>
</dd>
<dt>true_random: boolean</dt><dd><p>True: use true random
Fals: reshaping the data</p>
</dd>
<dt>true_random_multi: int/float</dt><dd><p>Tune the rate of random events. By default the rate R = true_random_multi* 0.5*raw_trace_length / trace_length</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>traces_return</strong> – Dictionary of random triggered traces</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="utilities-function">
<h2>Utilities function<a class="headerlink" href="#utilities-function" title="Permalink to this heading">¶</a></h2>
<p>Some utilities functions</p>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp._utils.Utils">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._utils.</span></span><span class="sig-name descname"><span class="pre">Utils</span></span><a class="headerlink" href="#pycrp._utils.Utils" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Chi2_reduced">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Chi2_reduced</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Chi2_reduced" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Exp">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Exp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Exp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Gauss">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Gauss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Gauss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Gauss_sideband">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Gauss_sideband</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Gauss_sideband" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Poisson">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Poisson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Lambda</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Poisson" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Poly">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Poly</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">P</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Poly" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute polynomial P(x) where P is a vector of coefficients
Lowest order coefficient at P[0].  Uses Horner’s Method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.Uniform">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Uniform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.Uniform" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.append_dicts">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">append_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.append_dicts" title="Permalink to this definition">¶</a></dt>
<dd><p>Append dict2 after dict1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.bilinear_interpolation">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">bilinear_interpolation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.bilinear_interpolation" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolate (x,y) from values associated with four points.</p>
<p>The four points are a list of four triplets:  (x, y, value).
The four points can be in any order.  They should form a rectangle.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bilinear_interpolation</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
<span class="gp">... </span>                        <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
<span class="gp">... </span>                        <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
<span class="gp">... </span>                        <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">300</span><span class="p">)])</span>
<span class="go">165.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.bilinear_interpolation_array">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">bilinear_interpolation_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.bilinear_interpolation_array" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.calc_parabola_vertex">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calc_parabola_vertex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.calc_parabola_vertex" title="Permalink to this definition">¶</a></dt>
<dd><p>3-point parabola:
<a class="reference external" href="http://stackoverflow.com/questions/717762/how-to-calculate-the-vertex-of-a-parabola-given-three-points">http://stackoverflow.com/questions/717762/how-to-calculate-the-vertex-of-a-parabola-given-three-points</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.center">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">center</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.center" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">color</span></span><a class="headerlink" href="#pycrp._utils.Utils.color" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.BLUE">
<span class="sig-name descname"><span class="pre">BLUE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[94m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.BLUE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.BOLD">
<span class="sig-name descname"><span class="pre">BOLD</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[1m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.BOLD" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.CYAN">
<span class="sig-name descname"><span class="pre">CYAN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[96m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.CYAN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.DARKCYAN">
<span class="sig-name descname"><span class="pre">DARKCYAN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[36m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.DARKCYAN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.END">
<span class="sig-name descname"><span class="pre">END</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[0m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.END" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.GREEN">
<span class="sig-name descname"><span class="pre">GREEN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[92m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.GREEN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.PURPLE">
<span class="sig-name descname"><span class="pre">PURPLE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[95m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.PURPLE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.RED">
<span class="sig-name descname"><span class="pre">RED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[91m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.RED" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.UNDERLINE">
<span class="sig-name descname"><span class="pre">UNDERLINE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[4m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.UNDERLINE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.YELLOW">
<span class="sig-name descname"><span class="pre">YELLOW</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'\x1b[93m'</span></em><a class="headerlink" href="#pycrp._utils.Utils.color.YELLOW" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.blue">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">blue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.blue" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.bold">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">bold</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.bold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.cyan">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cyan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.cyan" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.darkcyan">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">darkcyan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.darkcyan" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.green">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">green</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.green" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.purple">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">purple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.purple" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.red">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">red</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.red" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.underline">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">underline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.underline" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.color.yellow">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">yellow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ustring</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.color.yellow" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.contrast">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">contrast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.contrast" title="Permalink to this definition">¶</a></dt>
<dd><p>return (a-b*weight)/(a+b*weight)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.diff_coinc">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">diff_coinc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">list1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">list2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_nearest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.diff_coinc" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>return closest interval for each events in <cite>list1</cite></dt><dd><ul class="simple">
<li><p>if no list2 is provided, the closest one is found in list1</p></li>
<li><p>if list2 is provided, the closest one is found in list2</p></li>
</ul>
</dd>
</dl>
<p>dt =  t1 - t2_closest_to_t1 (positive dt means t1 is after t2)</p>
<dl class="simple">
<dt>list1: list</dt><dd><p>a list of numbers, doesn’t neet to be sorted</p>
</dd>
<dt>list2: list</dt><dd><p>a list of numbers, doesn’t neet to be sorted. If none, calculate dt of list1 alone</p>
</dd>
<dt>use_nearest: boolean</dt><dd><p>Only used when there is no list2
(Default) True: for each event returning the smaller one between the pre- and post- event interval
Fause: return the post-event interval. The last element is forced to inf</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul>
<li><p><strong>dts</strong> (<em>ndarray, length equal to list1</em>) –</p>
<dl class="simple">
<dt>If list2 is not provided:</dt><dd><ul class="simple">
<li><p>closest interval for each event in list1. positive value the means the interval is before the current event.</p></li>
</ul>
</dd>
<dt>If list2 is provided:</dt><dd><ul class="simple">
<li><p>closest interval for each event in list2. (positive dt means t1 is after t2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>inds2_coinc</strong> (<em>list of boolean</em>) –</p>
<dl class="simple">
<dt>If list2 is not provided:</dt><dd><p>the sign of dts</p>
</dd>
<dt>If list2 is provided:</dt><dd><p>the indices of the closest event in list2</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diff_coinc</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">2.4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">5.5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.downsample_fast">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">downsample_fast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.downsample_fast" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample the signal fast with boxcar filter</p>
<p>scipy.signal.decimate is the right way for serious downsampling.
However, when speed is the main consideration it’s x10 faster to use
simple boxcar filter</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array_like</em>) – The signal to be downsampled, as an 1 dimensional array.</p></li>
<li><p><strong>q</strong> (<em>int</em>) – The downsampling factor</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.find_crossing">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find_crossing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.find_crossing" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the interval in x corrsponding to a certain value in y
x: list of x values
y: list of y values
height: default to 1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.find_float">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find_float</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">string</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.find_float" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all float numbers inside a string</p>
<p>return_format: “float” or “str”</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.flatten1d">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">flatten1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.flatten1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Reduce an array to 1-d</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.fwhm">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fwhm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.fwhm" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the interval in x corrsponding to full width half maximum
x: list of x values
y: list of y values
height: default to 0.5 (half maximum)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.getIVserlist">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getIVserlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ser0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nser</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/slac/staas/fs1/g/supercdms/tf/nexus/midasdata/NEXUS/R7/Raw/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.getIVserlist" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of series after an initial series</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.get_dt">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_dt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">times1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">times2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_which</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nearest'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.get_dt" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate times2-times1</p>
<p>use_which: “before”,”nearest”,”after”</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.get_filelist">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_filelist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/sdf/group/supercdms/data/CDMS/NEXUS/R8/Raw'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.get_filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of files from the same series</p>
<blockquote>
<div><dl class="simple">
<dt>series: str</dt><dd><p><cite>series</cite> can be a string of series, or the filename containing wildcards
* if a series number is give, it will use the default filename pattern for NEXUS combined with <cite>data_dir</cite>
* if a filename with wildcard is given, it will fetch all files matching the wildcard</p>
</dd>
<dt>N_files: None, int, tuple or list</dt><dd><ul class="simple">
<li><p>None: return all filenames of this series</p></li>
<li><p>int N: return N filenames starting from the first one</p></li>
<li><p>tuple (N1,N2): return the N1^th to N2^th filenames</p></li>
<li><p>list: return the filenames following the indices in the list</p></li>
</ul>
</dd>
<dt>data_dir: str</dt><dd><p>path to raw data</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>file_list</strong> – a list of filenames</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>list of string</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.getsize">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getsize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.getsize" title="Permalink to this definition">¶</a></dt>
<dd><p>sum size of object &amp; members.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.groupby">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">groupby</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">item</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.groupby" title="Permalink to this definition">¶</a></dt>
<dd><p>Group the second list <cite>item</cite> with the first list <cite>key</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>key_grouped</em></p></li>
<li><p><em>item_grouped</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.is_odd">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_odd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.is_odd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.kmeans_1d">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">kmeans_1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.kmeans_1d" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.lin_interp">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">lin_interp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">half</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.lin_interp" title="Permalink to this definition">¶</a></dt>
<dd><p>Linear interpolation to find the x value at a given y, with 2 points in data around a index (i) and the y value (half)</p>
<p>data: list of y value
ind: x value</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.linear_interpolation">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">linear_interpolation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ind</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.linear_interpolation" title="Permalink to this definition">¶</a></dt>
<dd><p>Linear interpolation to find the y value at a given x, with 2 points in data around a index (x)</p>
<p>data: list of y value
ind: x value</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.merge_intervals">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">merge_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.merge_intervals" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://www.geeksforgeeks.org/merging-intervals/">https://www.geeksforgeeks.org/merging-intervals/</a>
# Python3 program to merge overlapping Intervals
# in O(n Log n) time and O(1) extra space</p>
<p>&gt;&gt; Driver code
&gt;&gt; arr = [[6, 8], [1, 9], [2, 4], [4, 7], [11,12]]
&gt;&gt; merge_intervals(arr)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.nll_poisson">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nll_poisson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.nll_poisson" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.parabola_3points">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">parabola_3points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_vertex</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.parabola_3points" title="Permalink to this definition">¶</a></dt>
<dd><p>Solve for A,B,C for parabola: A x1^2 + B x1 + C = y1 with 3 points</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.pch">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inner</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.pch" title="Permalink to this definition">¶</a></dt>
<dd><p>return (outer*(1+scale)-inner*(1-scale))/(outer*(1+scale)+inner*(1-scale))</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.rfft_corr">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">rfft_corr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.rfft_corr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.roll_fft">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">roll_fft</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.roll_fft" title="Permalink to this definition">¶</a></dt>
<dd><p>Roll array elements by non-interger number <cite>shift</cite>
using fft method</p>
<p>a: ndarray
shift: float</p>
<blockquote>
<div><p>positive is shifting to the right side</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>rolled array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.roll_zeropad">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">roll_zeropad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.roll_zeropad" title="Permalink to this definition">¶</a></dt>
<dd><p>Roll array elements along a given axis.</p>
<p>Elements off the end of the array are treated as pad_value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>array_like</em>) – Input array.</p></li>
<li><p><strong>shift</strong> (<em>int</em>) – The number of places by which elements are shifted.</p></li>
<li><p><strong>axis</strong> (<em>int</em><em>, </em><em>optional</em>) – The axis along which elements are shifted.  By default, the array
is flattened before shifting, after which the original
shape is restored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>res</strong> – Output array, with the same shape as <cite>a</cite>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">roll</span></code></dt><dd><p>Elements that roll off one end come back on the other.</p>
</dd>
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">rollaxis</span></code></dt><dd><p>Roll the specified axis backwards, until it lies in a given position.</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roll_zeropad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([0, 0, 0, 1, 2, 3, 4, 5, 6, 7])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roll_zeropad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="go">array([2, 3, 4, 5, 6, 7, 8, 9, 0, 0])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span>
<span class="go">array([[0, 1, 2, 3, 4],</span>
<span class="go">       [5, 6, 7, 8, 9]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roll_zeropad</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">array([[0, 0, 1, 2, 3],</span>
<span class="go">       [4, 5, 6, 7, 8]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roll_zeropad</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="go">array([[2, 3, 4, 5, 6],</span>
<span class="go">       [7, 8, 9, 0, 0]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roll_zeropad</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([[0, 0, 0, 0, 0],</span>
<span class="go">       [0, 1, 2, 3, 4]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.sortByExt">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">sortByExt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.sortByExt" title="Permalink to this definition">¶</a></dt>
<dd><p>Sort a list of filename by the last number in the filename.</p>
<dl class="simple">
<dt>files: list of str</dt><dd><p>filenames to sort</p>
</dd>
</dl>
<p>data_type: None, “NEXUS” or “Animal”</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>sorted filelist</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>filelist</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.split">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.split" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._utils.Utils.strike">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">strike</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._utils.Utils.strike" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="event-reader">
<h2>Event Reader<a class="headerlink" href="#event-reader" title="Permalink to this heading">¶</a></h2>
<p>_event.py script includes a few event reader functions for different IOs. You can use these functions to get raw event traces given the RQs.</p>
<p>import this module by <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">pycrp</span> <span class="pre">import</span> <span class="pre">*</span></code></p>
<p>Init: <code class="docutils literal notranslate"><span class="pre">event</span> <span class="pre">=</span> <span class="pre">Event(fs=config.Fs,</span> <span class="pre">series=args.series,</span> <span class="pre">ADC2uA=config.ADC2uA)</span></code></p>
<p>Read raw data from RQs: <code class="docutils literal notranslate"><span class="pre">event.get_raw_events_{io_type}</span></code>.</p>
<span class="target" id="module-pycrp._event"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp._event.Event">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp._event.</span></span><span class="sig-name descname"><span class="pre">Event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">series</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ADC2uA</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event" title="Permalink to this definition">¶</a></dt>
<dd><p>find the raw events using RQs. Support Animal, MIT, Argonne, NEXUS data.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.adc_to_amp">
<span class="sig-name descname"><span class="pre">adc_to_amp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NR6'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feedback_resistance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.adc_to_amp" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts adc values into Amps.
Settings: NR6 or NR7 to set the feedback resistance to 1.39e3 or 2.1e3 Ohm respectively.
If feedback_resistance is specified, than it overrides the “setting”.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.adc_to_ua">
<span class="sig-name descname"><span class="pre">adc_to_ua</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NR6'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feedback_resistance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.adc_to_ua" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts adc values into micro Amps.
Settings: NR6 or NR7 to set the feedback resistance to 1.39e3 or 2.1e3 Ohm respectively.
If feedback_resistance is specified, than it overrides the “setting”.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_combined_labels">
<span class="sig-name descname"><span class="pre">get_combined_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">combined_chs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_combined_labels" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_filenames_from_idx">
<span class="sig-name descname"><span class="pre">get_filenames_from_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indeces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_files_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/slac/staas/fs1/g/supercdms/tf/nexus/midasdata/NEXUS/R7/Raw'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_filenames_from_idx" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <cite>filename_idx</cite> RQ into full paths to the raw files. Can be used as the <cite>filenames</cite> argument in the <cite>get_raw_traces</cite> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>series</strong> (<em>str</em>) – series number, e.g. 25201129_095900</p></li>
<li><p><strong>indeces</strong> (<em>iterable</em>) – array of file indeces, as in the <cite>filename_idx</cite> RQ</p></li>
<li><p><strong>raw_files_dir</strong> (<em>str</em>) – path to the raw files directory. Uses NR7 path by default</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_raw_events_Animal">
<span class="sig-name descname"><span class="pre">get_raw_events_Animal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/fs1/home/z/zqhong/yongqi/SuperCDMS/AR74/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_raw_events_Animal" title="Permalink to this definition">¶</a></dt>
<dd><p>Get raw data from RQs</p>
<p>Inputs
—
data: RQs</p>
<blockquote>
<div><p>a dict with metadata</p>
</div></blockquote>
<dl class="simple">
<dt>mask: boolean list</dt><dd><p>Event selection mask</p>
</dd>
<dt>maxNumEvents: int</dt><dd><p>The maximum number of traces to be loaded.</p>
</dd>
<dt>channels: list of str</dt><dd><p>The channels to load</p>
</dd>
<dt>pre_trigger/post_prigger: int</dt><dd><p>Arbitrary unit of sampling, not ms or mus!</p>
</dd>
<dt>negative: boolean</dt><dd><p>negative if True</p>
</dd>
<dt>rawdir: str</dt><dd><p>The location of the directory containing the unprocessed data for series.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>traces</strong> – The dictionary with raw traces. Key: channel name. Values: raw traces.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_raw_events_Argonne">
<span class="sig-name descname"><span class="pre">get_raw_events_Argonne</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8192</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/fs1/home/z/zqhong/yongqi/Ricochet_data/'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_raw_events_Argonne" title="Permalink to this definition">¶</a></dt>
<dd><p>Get raw data from RQs</p>
<p>Inputs
—
data: RQs</p>
<blockquote>
<div><p>a dict with metadata</p>
</div></blockquote>
<dl class="simple">
<dt>mask: boolean list</dt><dd><p>Event selection mask</p>
</dd>
<dt>maxNumEvents: int</dt><dd><p>The maximum number of traces to be loaded.</p>
</dd>
<dt>channels: list of str</dt><dd><p>The channels to load</p>
</dd>
<dt>pre_trigger/post_prigger: int</dt><dd><p>Arbitrary unit of sampling, not ms or mus!</p>
</dd>
<dt>negative: boolean</dt><dd><p>negative if True</p>
</dd>
<dt>rawdir: str</dt><dd><p>The location of the directory containing the unprocessed data for series.</p>
</dd>
<dt>filename: str</dt><dd><p>The name of that file, can use * for the filename.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>traces</strong> – The dictionary with raw traces. Key: channel name. Values: raw traces.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_raw_events_MIT">
<span class="sig-name descname"><span class="pre">get_raw_events_MIT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8192</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/fs1/home/z/zqhong/yongqi/Ricochet_data/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_raw_events_MIT" title="Permalink to this definition">¶</a></dt>
<dd><p>Get raw data from RQs</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_raw_events_UMass">
<span class="sig-name descname"><span class="pre">get_raw_events_UMass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">24000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/project/def-zqhong/RicochetData/UMass/run28/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_raw_events_UMass" title="Permalink to this definition">¶</a></dt>
<dd><p>Get raw data from RQs</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp._event.Event.get_raw_traces_Nexus">
<span class="sig-name descname"><span class="pre">get_raw_traces_Nexus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filenames</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event_numbers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigpts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['PAS1',</span> <span class="pre">'PFS1',</span> <span class="pre">'PDS1']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels_to_combine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">combined_labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pretrig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">posttrig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3072</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zeros_out_of_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adc_conversion_setting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NR6'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feedback_resistance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chs_in_total</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['PAS1',</span> <span class="pre">'PFS1']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subtrack_meanbase</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">combining_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp._event.Event.get_raw_traces_Nexus" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary of 2d np.arrays with raw traces.
labels and combined_labels are the keys for the dictionary (+’Total’ if ‘chs_in_total’ is not empty).
If labels are not provided, chs keys are used for the output dictionary keys</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filenames</strong> (<em>1-d arrays</em><em> or </em><em>lists of the same length</em>) – filenames (full paths required), event numbers and trigger points of the required events.</p></li>
<li><p><strong>event_numbers</strong> (<em>1-d arrays</em><em> or </em><em>lists of the same length</em>) – filenames (full paths required), event numbers and trigger points of the required events.</p></li>
<li><p><strong>trigpts</strong> (<em>1-d arrays</em><em> or </em><em>lists of the same length</em>) – filenames (full paths required), event numbers and trigger points of the required events.</p></li>
<li><p><strong>n</strong> (<em>int</em>) – number of traces to read.</p></li>
<li><p><strong>chs</strong> (<em>list</em>) – channels to have in the output.</p></li>
<li><p><strong>channels_to_combine</strong> (<em>list of lists</em>) – each entry is a list of channels to sum up into one channel</p></li>
<li><p><strong>labels</strong> (<em>list</em>) – list of channel labels. Must be of the same length as chs. Used as the output dictionary keys
If empty, a list of channels is used as labels</p></li>
<li><p><strong>combined_labels</strong> (<em>list</em>) – list of labels for the combined channels. Must be of the same length as channels_to_combine.
If empty, channel names are concatenated with a plus sign. E.g.: “PES2 + PFS2”</p></li>
<li><p><strong>pretrig</strong> (<em>int</em>) – number of bins to include in the output before and after the trigger point</p></li>
<li><p><strong>posttrig</strong> (<em>int</em>) – number of bins to include in the output before and after the trigger point</p></li>
<li><p><strong>zeros_out_of_range</strong> (<em>bool</em>) – if True, put zeros in place of values that go beyond raw trace</p></li>
<li><p><strong>adc_conversion_setting</strong> (<em>string</em>) – use “NR6” or “NR7” to set the feedback resistance to 1.39e3 or 2.1e3 Ohm respectively for adc to Amp conversion</p></li>
<li><p><strong>feedback_resistance</strong> (<em>float</em>) – feedback resistance for the adc to amp conversion. Overrides the “setting” argument if &gt;0</p></li>
<li><p><strong>chs_in_total</strong> (<em>list</em>) – channels to add together to make a ‘Total’ channel in the output.
If an empty list is provided, the ‘Total’ channel won’t be created in the output.
Deprecated! Kept for backward compatibility. Use channels_to_combine instead!</p></li>
<li><p><strong>subtract_meanbase</strong> (<em>bool</em>) – if true, subtracts the mean value of the 90% of the pretrig trace region.
For example, if the pretrig=1000, trace = trace - np.mean(trace[:900])</p></li>
<li><p><strong>combining_weights</strong> (<em>list of lists of strings</em>) – weights to use when summing up the channels</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>traces</strong> – Dictionary of 2d np.arrays with raw traces.
Labels in ‘labels’ argument are the keys for the dictionary.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict of 2-d arrays</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="user-defined-io">
<h2>User defined IO<a class="headerlink" href="#user-defined-io" title="Permalink to this heading">¶</a></h2>
<p>IO functions to read specific datatype. Currently we support Animal(.hdf5) Argonne(.tdms) NEXUS(.mid.gz) and UMass(.hdf5) data</p>
<section id="module-pycrp.io_user.io_Animal">
<span id="animal"></span><h3>Animal<a class="headerlink" href="#module-pycrp.io_user.io_Animal" title="Permalink to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_Animal.</span></span><span class="sig-name descname"><span class="pre">IO_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-implemented class to handle file IO</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.filelist">
<span class="sig-name descname"><span class="pre">filelist</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>list of file names</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.nfiles">
<span class="sig-name descname"><span class="pre">nfiles</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.nfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>number of files in the list</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.ifile">
<span class="sig-name descname"><span class="pre">ifile</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file loaded</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.nextfile">
<span class="sig-name descname"><span class="pre">nextfile</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.nextfile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file to be loaded next</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.ntraces_per_file">
<span class="sig-name descname"><span class="pre">ntraces_per_file</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.ntraces_per_file" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces per file
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.itrace">
<span class="sig-name descname"><span class="pre">itrace</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.block_traces">
<span class="sig-name descname"><span class="pre">block_traces</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.block_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces to load per time
if set to -1, will load all traces in the file</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__(self,</span> <span class="pre">filelist,</span> <span class="pre">block_traces</span> <span class="pre">=</span> <span class="pre">-1):</span></span></dt>
<dd><p>Initialize class, with file list and optional a block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__get_ith_trace(f,</span> <span class="pre">res,</span> <span class="pre">i,</span> <span class="pre">idx):</span></span></dt>
<dd><p>Internal method, read ith trace out of the file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">n_chunks:</span></span></dt>
<dd><p>Return estimated number of chunks
For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_ifile:</span></span></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__io_read_user(ifile):</span></span></dt>
<dd><p>return a dictionary of data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">read():</span></span></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from ifile and itrace
Return None if done</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">process_metadata_user(metadata,</span> <span class="pre">trigger_result,</span> <span class="pre">trigger_points,i_trace,</span> <span class="pre">Fs</span> <span class="pre">=</span> <span class="pre">30000,</span> <span class="pre">\*\*kwargs):</span></span></dt>
<dd><p>Append metadata information to triggered results</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.__io_read_user">
<span class="sig-name descname"><span class="pre">__io_read_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ifile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.__io_read_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Open hdf5 file with filename=self.filelist[ifile],
parsed it with UMass format,
and return the parsed data in a dictionary format of
res[‘CHx’] = numpy.array([[],[]])</p>
<blockquote>
<div><p>where CHx can be CH1 or CH2,
the 2-d numpy array has multiple rows representing multiple traces,
and each row is a 1-d numpy array with data in unit of uA</p>
</div></blockquote>
<dl class="simple">
<dt>res[‘metadata’] = dict()</dt><dd><p>where ther dictionary hosts the metadata parsed from the hdf5 file</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>f</strong> (<em>string</em>) – File name of the Raw hdf5 data</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>res</strong> – Parsed data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dictionary</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.get_ifile">
<span class="sig-name descname"><span class="pre">get_ifile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.get_ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.get_raw_events">
<span class="sig-name descname"><span class="pre">get_raw_events</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/slac/staas/fs1/g/supercdms/tf/northwestern/AnimalData/AR68dm/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.get_raw_events" title="Permalink to this definition">¶</a></dt>
<dd><p>(Animal data only) This function fetches events with information from RQs</p>
<p>INPUT:
—</p>
<blockquote>
<div><dl class="simple">
<dt>data: dict</dt><dd><p>A dictionary that has at least the following information:
“SeriesNumber”, “filename_idx”, “trig_loc”</p>
</dd>
<dt>mask: boolean list</dt><dd><p>Event selection mask</p>
</dd>
<dt>maxNumEvents: int</dt><dd><p>The maximum number of <strong>DCRC events</strong> to be loaded PER SERIES.
If there are N series in <cite>data</cite>, N*maxNumEvents DCRC events will be read
Each event may have multiple triggers/traces.</p>
</dd>
<dt>pre_trig = 4096,post_trig = 4096</dt><dd><p>Trace length</p>
</dd>
<dt>pad_zeros: boolean or float</dt><dd><p>Whether to add zeros if the required trace length is longer than the existing data</p>
</dd>
<dt>channels: None, list</dt><dd><p>The channels to return. example: [‘PCS1’, ‘PDS1’, ‘PES1’, ‘PFS1’, ‘PES2’, ‘PFS2’]</p>
</dd>
<dt>rawdir:</dt><dd><p>The location of the directory containing the unprocessed data for series.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The dictionary of all traces</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>traces</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.n_chunks">
<span class="sig-name descname"><span class="pre">n_chunks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.n_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return estimated number of chunks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.process_metadata_user">
<span class="sig-name descname"><span class="pre">process_metadata_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1515151</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.process_metadata_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from nextfilefile and itrace</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal.IO_file.reset_counters">
<span class="sig-name descname"><span class="pre">reset_counters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal.IO_file.reset_counters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-pycrp.io_user.io_Animal_mat"></span><dl class="py class">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_Animal_mat.</span></span><span class="sig-name descname"><span class="pre">IO_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-implemented class to handle file IO</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.filelist">
<span class="sig-name descname"><span class="pre">filelist</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>list of file names</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.nfiles">
<span class="sig-name descname"><span class="pre">nfiles</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.nfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>number of files in the list</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.ifile">
<span class="sig-name descname"><span class="pre">ifile</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file loaded</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.nextfile">
<span class="sig-name descname"><span class="pre">nextfile</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.nextfile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file to be loaded next</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.ntraces_per_file">
<span class="sig-name descname"><span class="pre">ntraces_per_file</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.ntraces_per_file" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces per file
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.itrace">
<span class="sig-name descname"><span class="pre">itrace</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.block_traces">
<span class="sig-name descname"><span class="pre">block_traces</span></span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.block_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces to load per time
if set to -1, will load all traces in the file</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__(self,</span> <span class="pre">filelist,</span> <span class="pre">block_traces</span> <span class="pre">=</span> <span class="pre">-1):</span></span></dt>
<dd><p>Initialize class, with file list and optional a block_traces</p>
</dd></dl>

<dl class="simple">
<dt>n_chunks:</dt><dd><p>Return estimated number of chunks
For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt>get_ifile:</dt><dd><p>Return the file that <strong>was</strong> loaded</p>
</dd>
<dt>__io_read_user(ifile):</dt><dd><p>return a dictionary of data</p>
</dd>
<dt>read():</dt><dd><p>Return a dictionary of data of the next batch to be fetched
indexed from ifile and itrace
Return None if done</p>
</dd>
<dt>process_metadata_user(metadata, trigger_result, trigger_points,i_trace, Fs = 30000, <a href="#id7"><span class="problematic" id="id8">**</span></a>kwargs):</dt><dd><p>Append metadata information to triggered results</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.__io_read_user">
<span class="sig-name descname"><span class="pre">__io_read_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ifile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.__io_read_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.get_ifile">
<span class="sig-name descname"><span class="pre">get_ifile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.get_ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.n_chunks">
<span class="sig-name descname"><span class="pre">n_chunks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.n_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return estimated number of chunks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.process_metadata_user">
<span class="sig-name descname"><span class="pre">process_metadata_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30000</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.process_metadata_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Append metadata information to triggered results</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metadata</strong> (<em>dictionary</em>) – Dictionary of metadata</p></li>
<li><p><strong>trigger_result</strong> (<em>dictionary</em>) – Triggered resutls, with events
Will add metadata to this dictionary</p></li>
<li><p><strong>trigger_points</strong> (<em>array</em>) – An array of trigger points</p></li>
<li><p><strong>i_trace</strong> (<em>integer</em>) – The index of traces
Used to calculate the timestamp
if i_trace == 0, will initialize the ‘SeriesNumber’ and ‘timestamp’
keys in trigger_result</p></li>
<li><p><strong>Fs</strong> (<em>integer</em>) – Sampling frequency</p></li>
<li><p><strong>**kwargs</strong> (<em>stuff</em>) – To be compatible if more keys will be added</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Animal_mat.IO_file.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Animal_mat.IO_file.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from nextfilefile and itrace</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pycrp.io_user.io_Argonne">
<span id="argonne"></span><h3>Argonne<a class="headerlink" href="#module-pycrp.io_user.io_Argonne" title="Permalink to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_Argonne.</span></span><span class="sig-name descname"><span class="pre">IO_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-implemented class to handle file IO
For Argonne data, one file contains a few hours of data. Only one file can be read each time.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.filelist">
<span class="sig-name descname"><span class="pre">filelist</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>list of file names</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.nfiles">
<span class="sig-name descname"><span class="pre">nfiles</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.nfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces (not files for Argonne!) in the list</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.ifile">
<span class="sig-name descname"><span class="pre">ifile</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the traces loaded</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.nextfile">
<span class="sig-name descname"><span class="pre">nextfile</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.nextfile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.ntraces_per_file">
<span class="sig-name descname"><span class="pre">ntraces_per_file</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.ntraces_per_file" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces per file
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.itrace">
<span class="sig-name descname"><span class="pre">itrace</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.block_traces">
<span class="sig-name descname"><span class="pre">block_traces</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.block_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces to load per time
if set to -1, will load all traces in the file</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.objfile">
<span class="sig-name descname"><span class="pre">objfile</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.objfile" title="Permalink to this definition">¶</a></dt>
<dd><p>currently opened file object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>object</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.metadata">
<span class="sig-name descname"><span class="pre">metadata</span></span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Holding metadata retrieved from raw data</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__(self,</span> <span class="pre">filelist,</span> <span class="pre">block_traces</span> <span class="pre">=</span> <span class="pre">-1):</span></span></dt>
<dd><p>Initialize class, with file list and optional a block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reset_counters(self):</span></span></dt>
<dd><p>Reset ifile, nextfile and itrace counters</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__get_ith_trace(f,</span> <span class="pre">res,</span> <span class="pre">i,</span> <span class="pre">idx):</span></span></dt>
<dd><p>Internal method, read ith trace out of the file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">n_chunks:</span></span></dt>
<dd><p>Return estimated number of chunks
For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_ifile:</span></span></dt>
<dd><p>Return the trace that <strong>was</strong> loaded
Note, get_ifile will be different from self.ifile by 1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__io_read_user(filename):</span></span></dt>
<dd><p>return a dictionary of data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">read():</span></span></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from ifile and itrace
Return None if done</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">process_metadata_user(metadata,</span> <span class="pre">trigger_result,</span> <span class="pre">trigger_points,i_trace,</span> <span class="pre">Fs</span> <span class="pre">=</span> <span class="pre">30000,</span> <span class="pre">\*\*kwargs):</span></span></dt>
<dd><p>Append metadata information to triggered results</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.__get_ith_trace">
<span class="sig-name descname"><span class="pre">__get_ith_trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">res</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.__get_ith_trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Load ith trace of the current file
save it in idx row of res[‘CHx’]</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.__io_read_user">
<span class="sig-name descname"><span class="pre">__io_read_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">read_traces</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.__io_read_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.get_ifile">
<span class="sig-name descname"><span class="pre">get_ifile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.get_ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.get_itrace">
<span class="sig-name descname"><span class="pre">get_itrace</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.get_itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the trace that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.get_metadata">
<span class="sig-name descname"><span class="pre">get_metadata</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.get_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch metadata and populate them into self.metadata</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.n_chunks">
<span class="sig-name descname"><span class="pre">n_chunks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.n_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return estimated number of chunks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.process_metadata_user">
<span class="sig-name descname"><span class="pre">process_metadata_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1515151</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.process_metadata_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
from ifile and itrace</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_Argonne.IO_file.reset_counters">
<span class="sig-name descname"><span class="pre">reset_counters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_Argonne.IO_file.reset_counters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-pycrp.io_user.io_NEXUS">
<span id="nexus"></span><h3>NEXUS<a class="headerlink" href="#module-pycrp.io_user.io_NEXUS" title="Permalink to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_NEXUS.</span></span><span class="sig-name descname"><span class="pre">IO_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-implemented class to handle file IO</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.filelist">
<span class="sig-name descname"><span class="pre">filelist</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>list of file names</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.nfiles">
<span class="sig-name descname"><span class="pre">nfiles</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.nfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>number of files in the list</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.ifile">
<span class="sig-name descname"><span class="pre">ifile</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file loaded</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.nextfile">
<span class="sig-name descname"><span class="pre">nextfile</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.nextfile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file to be loaded next</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.ntraces_per_file">
<span class="sig-name descname"><span class="pre">ntraces_per_file</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.ntraces_per_file" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces per file
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.itrace">
<span class="sig-name descname"><span class="pre">itrace</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.block_traces">
<span class="sig-name descname"><span class="pre">block_traces</span></span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.block_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces to load per time
if set to -1, will load all traces in the file</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__(self,</span> <span class="pre">filelist,</span> <span class="pre">block_traces</span> <span class="pre">=</span> <span class="pre">-1):</span></span></dt>
<dd><p>Initialize class, with file list and optional a block_traces</p>
</dd></dl>

<dl class="simple">
<dt>n_chunks:</dt><dd><p>Return estimated number of chunks
For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt>get_ifile:</dt><dd><p>Return the file that <strong>was</strong> loaded</p>
</dd>
<dt>__io_read_user(ifile):</dt><dd><p>return a dictionary of data</p>
</dd>
<dt>read():</dt><dd><p>Return a dictionary of data of the next batch to be fetched
indexed from ifile and itrace
Return None if done</p>
</dd>
<dt>process_metadata_user(metadata, trigger_result, trigger_points,i_trace, Fs = 30000, <a href="#id9"><span class="problematic" id="id10">**</span></a>kwargs):</dt><dd><p>Append metadata information to triggered results</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.__io_read_user">
<span class="sig-name descname"><span class="pre">__io_read_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ifile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.__io_read_user" title="Permalink to this definition">¶</a></dt>
<dd><p>read midas file from DCRC</p>
<p>NEXUS files are loaded into a dict of int16 arrays.
Traces are already centerd at 0 and flipped.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.get_ifile">
<span class="sig-name descname"><span class="pre">get_ifile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.get_ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.n_chunks">
<span class="sig-name descname"><span class="pre">n_chunks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.n_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return estimated number of chunks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.process_metadata_user">
<span class="sig-name descname"><span class="pre">process_metadata_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1515151</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.process_metadata_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from nextfilefile and itrace</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.IO_file.reset_counters">
<span class="sig-name descname"><span class="pre">reset_counters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.IO_file.reset_counters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.get_filenames_from_idx">
<span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_NEXUS.</span></span><span class="sig-name descname"><span class="pre">get_filenames_from_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indeces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_files_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/slac/staas/fs1/g/supercdms/tf/nexus/midasdata/NEXUS/R7/Raw'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.get_filenames_from_idx" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts <cite>filename_idx</cite> RQ into full paths to the raw files. Can be used as the <cite>filenames</cite> argument in the <cite>get_raw_traces</cite> function.</p>
<dl class="simple">
<dt>series<span class="classifier">str</span></dt><dd><p>series number, e.g. 25201129_095900</p>
</dd>
<dt>indeces<span class="classifier">iterable</span></dt><dd><p>array of file indeces, as in the <cite>filename_idx</cite> RQ</p>
</dd>
<dt>raw_files_dir<span class="classifier">str</span></dt><dd><p>path to the raw files directory. Uses NR7 path by default</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.get_raw_events">
<span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_NEXUS.</span></span><span class="sig-name descname"><span class="pre">get_raw_events</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/slac/staas/fs1/g/supercdms/tf/nexus/midasdata/NEXUS/R7/Raw/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.get_raw_events" title="Permalink to this definition">¶</a></dt>
<dd><p>(MIDAS data only) This function fetches events with information from RQs</p>
<p>INPUT:
—</p>
<blockquote>
<div><dl class="simple">
<dt>data: dict</dt><dd><p>A dictionary that has at least the following information:
“SeriesNumber”, “EventNumber”, “trig_loc”</p>
</dd>
<dt>mask: boolean list</dt><dd><p>Event selection mask</p>
</dd>
<dt>maxNumEvents: int</dt><dd><p>The maximum number of <strong>DCRC events</strong> to be loaded PER SERIES.
If there are N series in <cite>data</cite>, N*maxNumEvents DCRC events will be read
Each event may have multiple triggers/traces.</p>
</dd>
<dt>pre_trig = 4096,post_trig = 4096</dt><dd><p>Trace length</p>
</dd>
<dt>pad_zeros: boolean</dt><dd><p>Whether to add zeros if the required trace length is longer than the existing data</p>
</dd>
<dt>channels: None, list</dt><dd><p>The channels to return. example: [‘PCS1’, ‘PDS1’, ‘PES1’, ‘PFS1’, ‘PES2’, ‘PFS2’]</p>
</dd>
<dt>rawdir:</dt><dd><p>The location of the directory containing the unprocessed data for series.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The dictionary of all traces</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>traces</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pycrp.io_user.io_NEXUS.get_raw_events_singleseries">
<span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_NEXUS.</span></span><span class="sig-name descname"><span class="pre">get_raw_events_singleseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxNumEvents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_trig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fast_reader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/gpfs/slac/staas/fs1/g/supercdms/tf/nexus/midasdata/NEXUS/R7/Raw/'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_NEXUS.get_raw_events_singleseries" title="Permalink to this definition">¶</a></dt>
<dd><p>(MIDAS data only) This function returns a dictionary of traces from a single series
INPUT:
—</p>
<blockquote>
<div><dl class="simple">
<dt>data: dict</dt><dd><p>A dictionary that has at least the following information:
“SeriesNumber”, “EventNumber”, “trig_loc”</p>
</dd>
<dt>mask: boolean list</dt><dd><p>Event selection mask</p>
</dd>
<dt>maxNumEvents: int</dt><dd><p>The maximum number of DCRC events to be loaded.
Each event may have multiple triggers/traces.</p>
</dd>
<dt>channels: None, list</dt><dd><p>The channels to return. example: [‘PCS1’, ‘PDS1’, ‘PES1’, ‘PFS1’, ‘PES2’, ‘PFS2’]</p>
</dd>
<dt>pre_trig = 4096,post_trig = 4096</dt><dd><p>Trace length</p>
</dd>
<dt>pad_zeros: boolean or int</dt><dd><p>Whether to add zeros if the required trace length is longer than the existing data
if int, pad with the given number</p>
</dd>
<dt>return_raw: boolean</dt><dd><p>Whether return the raw trace</p>
</dd>
<dt>rawdir:</dt><dd><p>The location of the directory containing the unprocessed data for series.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The dictionary of all traces</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>traces</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pycrp.io_user.io_UMass">
<span id="umass"></span><h3>UMass<a class="headerlink" href="#module-pycrp.io_user.io_UMass" title="Permalink to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_UMass.</span></span><span class="sig-name descname"><span class="pre">IO_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_traces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-implemented class to handle file IO</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.filelist">
<span class="sig-name descname"><span class="pre">filelist</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>list of file names</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.nfiles">
<span class="sig-name descname"><span class="pre">nfiles</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.nfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>number of files in the list</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.ifile">
<span class="sig-name descname"><span class="pre">ifile</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file loaded</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.nextfile">
<span class="sig-name descname"><span class="pre">nextfile</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.nextfile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file to be loaded next</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.ntraces_per_file">
<span class="sig-name descname"><span class="pre">ntraces_per_file</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.ntraces_per_file" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces per file
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.itrace">
<span class="sig-name descname"><span class="pre">itrace</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.block_traces">
<span class="sig-name descname"><span class="pre">block_traces</span></span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.block_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces to load per time
if set to -1, will load all traces in the file</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__(self,</span> <span class="pre">filelist,</span> <span class="pre">block_traces</span> <span class="pre">=</span> <span class="pre">-1):</span></span></dt>
<dd><p>Initialize class, with file list and optional a block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__get_ith_trace(f,</span> <span class="pre">res,</span> <span class="pre">i,</span> <span class="pre">idx):</span></span></dt>
<dd><p>Internal method, read ith trace out of the file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">n_chunks:</span></span></dt>
<dd><p>Return estimated number of chunks
For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_ifile:</span></span></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__io_read_user(ifile):</span></span></dt>
<dd><p>return a dictionary of data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">read():</span></span></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from ifile and itrace
Return None if done</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">process_metadata_user(metadata,</span> <span class="pre">trigger_result,</span> <span class="pre">trigger_points,i_trace,</span> <span class="pre">Fs</span> <span class="pre">=</span> <span class="pre">30000,</span> <span class="pre">\*\*kwargs):</span></span></dt>
<dd><p>Append metadata information to triggered results</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.__get_ith_trace">
<span class="sig-name descname"><span class="pre">__get_ith_trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">res</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.__get_ith_trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a trace with index “i” from file “f”
and append it to dictionary res.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<em>dictionary-like</em>) – Raw data from hdf5 files loaded with
f = h5py.File(filename)</p></li>
<li><p><strong>res</strong> (<em>dictionary</em>) – Parsed data</p></li>
<li><p><strong>i</strong> (<em>string</em>) – Index of traces in raw data</p></li>
<li><p><strong>idx</strong> (<em>integer</em>) – Index number of trace in final numpy array</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>1 if successful, 0 if error</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.__io_read_user">
<span class="sig-name descname"><span class="pre">__io_read_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ifile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.__io_read_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Open hdf5 file with filename=self.filelist[ifile],
parsed it with UMass format,
and return the parsed data in a dictionary format of
res[‘CHx’] = numpy.array([[],[]])</p>
<blockquote>
<div><p>where CHx can be CH1 or CH2,
the 2-d numpy array has multiple rows representing multiple traces,
and each row is a 1-d numpy array with data in unit of uA</p>
</div></blockquote>
<dl class="simple">
<dt>res[‘metadata’] = dict()</dt><dd><p>where ther dictionary hosts the metadata parsed from the hdf5 file</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>f</strong> (<em>string</em>) – File name of the Raw hdf5 data</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>res</strong> – Parsed data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dictionary</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.get_ifile">
<span class="sig-name descname"><span class="pre">get_ifile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.get_ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the file that <strong>was</strong> loaded</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.n_chunks">
<span class="sig-name descname"><span class="pre">n_chunks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.n_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return estimated number of chunks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>None</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.process_metadata_user">
<span class="sig-name descname"><span class="pre">process_metadata_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trigger_points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_trace</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Fs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30000</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.process_metadata_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Append metadata information to triggered results</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metadata</strong> (<em>dictionary</em>) – Dictionary of metadata</p></li>
<li><p><strong>trigger_result</strong> (<em>dictionary</em>) – Triggered resutls, with events
Will add metadata to this dictionary</p></li>
<li><p><strong>trigger_points</strong> (<em>array</em>) – An array of trigger points</p></li>
<li><p><strong>i_trace</strong> (<em>integer</em>) – The index of traces
Used to calculate the timestamp
if i_trace == 0, will initialize the ‘SeriesNumber’ and ‘timestamp’
keys in trigger_result</p></li>
<li><p><strong>Fs</strong> (<em>integer</em>) – Sampling frequency</p></li>
<li><p><strong>**kwargs</strong> (<em>stuff</em>) – To be compatible if more keys will be added</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from nextfilefile and itrace</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_UMass.IO_file.reset_counters">
<span class="sig-name descname"><span class="pre">reset_counters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_UMass.IO_file.reset_counters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
</section>
<section id="io-template">
<h2>IO template<a class="headerlink" href="#io-template" title="Permalink to this heading">¶</a></h2>
<p>The template IO file if you want to work on a different datatype. Follow the template and write your code to load the file.</p>
<span class="target" id="module-pycrp.io_user.io_template"></span><p>Template for user-implemented IO libraries</p>
<dl class="py class">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pycrp.io_user.io_template.</span></span><span class="sig-name descname"><span class="pre">IO_file</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file" title="Permalink to this definition">¶</a></dt>
<dd><p>A user-implemented class to handle file IO</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.filelist">
<span class="sig-name descname"><span class="pre">filelist</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.filelist" title="Permalink to this definition">¶</a></dt>
<dd><p>list of file names</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.nfiles">
<span class="sig-name descname"><span class="pre">nfiles</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.nfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>number of files in the list</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.ifile">
<span class="sig-name descname"><span class="pre">ifile</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.ifile" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the file to be loaded next</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.ntraces_per_file">
<span class="sig-name descname"><span class="pre">ntraces_per_file</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.ntraces_per_file" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces per file
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.itrace">
<span class="sig-name descname"><span class="pre">itrace</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.itrace" title="Permalink to this definition">¶</a></dt>
<dd><p>index of the trace to be loaded next
not used if block_traces is set to -1</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.block_traces">
<span class="sig-name descname"><span class="pre">block_traces</span></span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.block_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>number of traces to load per time
if set to -1, will load all traces in the file</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__(self,</span> <span class="pre">filelist,</span> <span class="pre">block_traces</span> <span class="pre">=</span> <span class="pre">-1):</span></span></dt>
<dd><p>Initialize class, with file list and optional a block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">n_chunks:</span></span></dt>
<dd><p>Return estimated number of chunks
For block_traces==-1, it’s usually nfiles
For block_traces &gt; 0, it’s nfiles x ntraces_per_file / block_traces</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_ifile:</span></span></dt>
<dd><p>Return the file that <strong>was</strong> loaded
Note, get_ifile will be different from self.ifile by 1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reset_counters(self):</span></span></dt>
<dd><p>reset the file and chunck counter</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pycrp.io_user.io_template.IO_file.io_read_user">
<span class="sig-name descname"><span class="pre">io_read_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename):</span> <span class="pre">(Optional</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pycrp.io_user.io_template.IO_file.io_read_user" title="Permalink to this definition">¶</a></dt>
<dd><p>return a dictionary of data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">read():</span></span></dt>
<dd><p>Return a dictionary of data of the next batch to be fetched
indexed from ifile and itrace
Return None if done</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">process_metadata_user(metadata,</span> <span class="pre">trigger_result,</span> <span class="pre">trigger_points,i_trace,</span> <span class="pre">Fs</span> <span class="pre">=</span> <span class="pre">30000,</span> <span class="pre">\*\*kwargs):</span></span></dt>
<dd><p>Append metadata information to triggered results</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="#">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">pyCRP: python Continuous Readout Processing documentation</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#frequently-encountered-errors">Frequently Encountered Errors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scripts">Scripts</a><ul>
<li><a class="reference internal" href="#fitting-tools">Fitting tools</a></li>
<li><a class="reference internal" href="#io">IO</a></li>
<li><a class="reference internal" href="#trigger">Trigger</a></li>
<li><a class="reference internal" href="#cut-methods">Cut methods</a></li>
<li><a class="reference internal" href="#id4">Midas</a></li>
<li><a class="reference internal" href="#noise">Noise</a></li>
<li><a class="reference internal" href="#optimum-filter">Optimum Filter</a></li>
<li><a class="reference internal" href="#reduced-quantities-rqs">Reduced Quantities (RQs)</a></li>
<li><a class="reference internal" href="#trace">Trace</a></li>
<li><a class="reference internal" href="#utilities-function">Utilities function</a></li>
<li><a class="reference internal" href="#event-reader">Event Reader</a></li>
<li><a class="reference internal" href="#user-defined-io">User defined IO</a><ul>
<li><a class="reference internal" href="#module-pycrp.io_user.io_Animal">Animal</a></li>
<li><a class="reference internal" href="#module-pycrp.io_user.io_Argonne">Argonne</a></li>
<li><a class="reference internal" href="#module-pycrp.io_user.io_NEXUS">NEXUS</a></li>
<li><a class="reference internal" href="#module-pycrp.io_user.io_UMass">UMass</a></li>
</ul>
</li>
<li><a class="reference internal" href="#io-template">IO template</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">pyCRP 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyCRP: python Continuous Readout Processing documentation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, SuperCDMS.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.1.
    </div>
  </body>
</html>